/*! For license information please see aframe-loader-3dtiles-component.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],e);else{var r="object"==typeof exports?e(require("THREE")):e(t.THREE);for(var s in r)("object"==typeof exports?exports:t)[s]=r[s]}}(this,(function(t){return(()=>{var e={384:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("textarea",{schema:{transparentBG:{type:"boolean",default:!1},cols:{type:"int",default:40},rows:{type:"int",default:20},color:{type:"color",default:"black"},backgroundColor:{type:"color",default:"white"},disabledBackgroundColor:{type:"color",default:"lightgrey"},disabled:{type:"boolean",default:!1},text:{type:"string",default:""}},init:function(){this.text=null,this.lines=[],this.lastBlink=0,this.blinkEnabled=!this.data.disabled,this.charWidth=this.charHeight=null,this.selectionStart=this.selectionEnd=0,this.endIndexInfo=this.startIndexInfo=null,this.origin={x:0,y:0},this.background=document.createElement("a-plane"),this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor),this.el.appendChild(this.background),this.data.transparentBG&&this.background.setAttribute("material",{opacity:0,transparent:!0}),this.textAnchor=document.createElement("a-entity"),this.el.appendChild(this.textAnchor),this.textAnchor.setAttribute("text",{mode:"pre",baseline:"top",anchor:"center",font:"dejavu",wrapCount:this.data.cols,height:this.data.rows,color:this.data.color}),this._initTextarea(),this.el.addEventListener("textfontset",this._updateCharMetrics.bind(this)),this.el.addEventListener("char-metrics-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("text-changed",this._updateLines.bind(this)),this.el.addEventListener("text-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("selection-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("selection-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("lines-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("index-info-changed",this._updateOrigin.bind(this)),this.el.addEventListener("index-info-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("origin-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("click",this.focus.bind(this))},update:function(t){this.data.text!==t.text&&this._updateTextarea(),this.data.backgroundColor===t.backgroundColor&&this.data.disabledBackgroundColor===t.disabledBackgroundColor||this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor),this.data.disabled!==t.disabled&&(this.blinkEnabled=!this.data.disabled,this.textarea.disabled=this.data.disabled,this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor))},focus:function(){this.textarea.focus()},_initTextarea:function(){this.textarea=document.createElement("textarea"),document.body.appendChild(this.textarea),this._updateTextarea()},_updateTextarea:function(){this.textarea.style.whiteSpace="pre",this.textarea.style.overflow="hidden",this.textarea.style.opacity="0",this.textarea.cols=this.data.cols,this.textarea.rows=this.data.rows,this.textarea.value=this.data.text,this.textarea.selectionStart=0,this.textarea.selectionEnd=0,this._updateIndexInfo()},_emit:function(t,e){this.el.emit(t,e)},_updateCharMetrics:function(t){const e=this.textAnchor.components.text.geometry.layout,r=t.detail.fontObj.widthFactor;this.charWidth=r*this.textAnchor.object3DMap.text.scale.x,this.charHeight=this.charWidth*e.lineHeight/r,this.textAnchor.setAttribute("position",{x:0,y:this.charHeight*this.data.rows/2,z:0}),this.data.transparentBG||(this.background.setAttribute("scale",{x:1.05,y:this.charHeight*this.data.rows*1.05,z:1}),this.background.setAttribute("position",{x:0,y:0,z:0})),this._emit("char-metrics-changed")},_checkAndUpdateSelection:function(){if(this.selectionStart===this.textarea.selectionStart&&this.selectionEnd===this.textarea.selectionEnd)return;const t=this.selectionStart,e=this.selectionEnd;this.selectionStart=this.textarea.selectionStart,this.selectionEnd=this.textarea.selectionEnd,this._emit("selection-changed",{start:{old:t,new:this.selectionStart,changed:this.selectionStart!==t},end:{old:e,new:this.selectionEnd,changed:this.selectionEnd!==e}})},tick:function(t){t-this.lastBlink>500&&this.blinkEnabled&&(this.lastBlink=t),this._checkAndUpdateSelection(),this._checkAndUpdateText()},_getIndexInfo:function(t,e){const r=Math.max(0,t),s=this.lines[r];return{line:s,x:(e-s.start)*this.charWidth,y:-this.charHeight*r+-this.charHeight/2}},_updateIndexInfo:function(){if(!this.lines.length)return;const t=this.startIndexInfo&&this.startIndexInfo.line.index,e=this.endIndexInfo&&this.endIndexInfo.line.index;let r;this.startIndexInfo=null,this.endIndexInfo=null;let s=!1,i=!1;for(r=0;r<=this.lines.length;r++){const n=this.lines[r-1],o=r===this.lines.length?n.start+n.length+1:this.lines[r].start;if(o>this.selectionStart&&!this.startIndexInfo&&(this.startIndexInfo=this._getIndexInfo(r-1,this.selectionStart),this.startIndexInfo.line.index!==t&&(s=!0)),o>this.selectionEnd){this.endIndexInfo=this._getIndexInfo(r-1,this.selectionEnd),this.endIndexInfo.line.index!==e&&(i=!0);break}}(s||i)&&this._emit("index-info-changed",{start:{changed:s},end:{changed:i}})},_updateOrigin:function(t){let e=!1;if(t.detail.end.changed){const t=this.origin.y+this.data.rows-1;this.endIndexInfo.line.index>t?(this.origin.y=this.endIndexInfo.line.index+1-this.data.rows,e=!0):this.endIndexInfo.line.index<this.origin.y&&(this.origin.y=this.endIndexInfo.line.index,e=!0)}t.detail.start.changed&&this.startIndexInfo.line.index<this.origin.y&&(this.origin.y=this.startIndexInfo.line.index,e=!0),e&&this._emit("origin-changed")},_updateHorizontalOrigin:function(t){if(!this.endIndexInfo)return;let e=!0;if(t.detail.end.changed){const t=this.selectionEnd-this.endIndexInfo.line.start;t>this.origin.x+this.data.cols?(this.origin.x=t-this.data.cols,e=!0):t<this.origin.x&&(this.origin.x=t,e=!0)}const r=this.selectionStart-this.startIndexInfo.line.start;t.detail.start.changed&&(r>this.origin.x+this.data.cols?(this.origin.x=r-this.data.cols,e=!0):r<this.origin.x&&(this.origin.x=r,e=!0)),e&&this._emit("origin-changed")},_updateLines:function(){this.lines=[];const t=this.text.split("\n");let e=0;for(let r=0;r<t.length;r++)this.lines[r]={index:r,length:t[r].length,start:e},e+=t[r].length+1;this._emit("lines-changed")},_getViewportText:function(){return this.text.split("\n").slice(this.origin.y,this.origin.y+this.data.rows).map(function(t){return t.substr(this.origin.x,this.data.cols)||" "}.bind(this)).join("\n")},_updateDisplayText:function(){this.textAnchor.setAttribute("text",{value:this._getViewportText()})},_checkAndUpdateText:function(){const t=this.textarea.value;t!==this.text&&(this.text=t,this._emit("text-changed"))}})},824:e=>{"use strict";e.exports=t}},r={};function s(t){var i=r[t];if(void 0!==i)return i.exports;var n=r[t]={exports:{}};return e[t](n,n.exports,s),n.exports}s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{"use strict";s.r(i);var t=s(824);function e(t,e,r,s){return new(r||(r=Promise))((function(i,n){function o(t){try{c(s.next(t))}catch(t){n(t)}}function a(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}function r(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const n={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},o=n.global||n.self||n.window||{},a="object"!=typeof process||"[object process]"!==String(process)||process.browser,c="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function h(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}c&&parseFloat(c[1]);const u={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},l=u.global||u.self||u.window||{},d="object"!=typeof process||"[object process]"!==String(process)||process.browser,f="function"==typeof importScripts,p="undefined"!=typeof window&&void 0!==window.orientation,m="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function g(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}m&&parseFloat(m[1]);class y{constructor(t,e){g(this,"name",void 0),g(this,"workerThread",void 0),g(this,"isRunning",void 0),g(this,"result",void 0),g(this,"_resolve",void 0),g(this,"_reject",void 0),this.name=t,this.workerThread=e,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){h(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){h(this.isRunning),this.isRunning=!1,this._reject(t)}}const b=new Map;function w(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function T(t,e=!0,r){const s=r||new Set;if(t)if(v(t))s.add(t);else if(v(t.buffer))s.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const r in t)T(t[r],e,s);return void 0===r?Array.from(s):[]}function v(t){return!!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}const _=()=>{};class E{static isSupported(){return"undefined"!=typeof Worker}constructor(t){g(this,"name",void 0),g(this,"source",void 0),g(this,"url",void 0),g(this,"terminated",!1),g(this,"worker",void 0),g(this,"onMessage",void 0),g(this,"onError",void 0),g(this,"_loadableURL","");const{name:e,source:r,url:s}=t;h(r||s),this.name=e,this.source=r,this.url=s,this.onMessage=_,this.onError=t=>console.log(t),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=_,this.onError=_,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||T(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=function(t){h(t.source&&!t.url||!t.source&&t.url);let e=b.get(t.source||t.url);return e||(t.url&&(e=function(t){return t.startsWith("http")?w(`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):t}(t.url),b.set(t.url,e)),t.source&&(e=w(t.source),b.set(t.source,e))),h(e),e}({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}}class x{constructor(t){g(this,"name","unnamed"),g(this,"source",void 0),g(this,"url",void 0),g(this,"maxConcurrency",1),g(this,"maxMobileConcurrency",1),g(this,"onDebug",(()=>{})),g(this,"reuseWorkers",!0),g(this,"props",{}),g(this,"jobQueue",[]),g(this,"idleQueue",[]),g(this,"count",0),g(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t,e=((t,e,r)=>t.done(r)),r=((t,e)=>t.error(e))){const s=new Promise((s=>(this.jobQueue.push({name:t,onMessage:e,onError:r,onStart:s}),this)));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new y(e.name,t);t.onMessage=t=>e.onMessage(r,t.type,t.payload),t.onError=t=>e.onError(r,t),e.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new E({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return p?this.maxMobileConcurrency:this.maxConcurrency}}const S={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class M{static isSupported(){return E.isSupported()}static getWorkerFarm(t={}){return M._workerFarm=M._workerFarm||new M({}),M._workerFarm.setProps(t),M._workerFarm}constructor(t){g(this,"props",void 0),g(this,"workerPools",new Map),this.props={...S},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy()}setProps(t){this.props={...this.props,...t};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:r,url:s}=t;let i=this.workerPools.get(e);return i||(i=new x({name:e,source:r,url:s}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}g(M,"_workerFarm",void 0);var A={};const I={};async function R(t,e=null,r={}){return e&&(t=function(t,e,r){if(t.startsWith("http"))return t;const s=r.modules||{};return s[t]?s[t]:d?r.CDN?(h(r.CDN.startsWith("http")),`${r.CDN}/${e}@3.0.10/dist/libs/${t}`):f?`../src/libs/${t}`:`modules/${e}/src/libs/${t}`:`modules/${e}/dist/libs/${t}`}(t,e,r)),I[t]=I[t]||async function(t){if(t.endsWith("wasm")){const e=await fetch(t);return await e.arrayBuffer()}if(!d)return A.requireFromFile&&await A.requireFromFile(t);if(f)return importScripts(t);const e=await fetch(t);return function(t,e){if(!d)return A.requireFromString&&A.requireFromString(t,e);if(f)return eval.call(l,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}(await e.text(),t)}(t),await I[t]}async function O(t,e,r,s,i){const n=t.id,o=function(t,e={}){const r=e[t.id]||{},s=`${t.id}-worker.js`;let i=r.workerUrl;if("test"===e._workerType&&(i=`modules/${t.module}/dist/${s}`),!i){let e=t.version;"latest"===e&&(e="latest");const r=e?`@${e}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${r}/dist/${s}`}return h(i),i}(t,r),a=M.getWorkerFarm(r).getWorkerPool({name:n,url:o});r=JSON.parse(JSON.stringify(r));const c=await a.startJob("process-on-worker",C.bind(null,i));c.postMessage("process",{input:e,options:r});const u=await c.result;return await u.result}async function C(t,e,r,s){switch(r){case"done":e.done(s);break;case"error":e.error(s.error);break;case"process":const{id:i,input:n,options:o}=s;try{const r=await t(n,o);e.postMessage("done",{id:i,result:r})}catch(t){const r=t instanceof Error?t.message:"unknown error";e.postMessage("error",{id:i,error:r})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function L(t,e,r){if(t.byteLength<=e+r)return"";const s=new DataView(t);let i="";for(let t=0;t<r;t++)i+=String.fromCharCode(s.getUint8(e+t));return i}function N(t){if(A.toArrayBuffer&&(t=A.toArrayBuffer(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function P(t,e,r){const s=void 0!==r?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(s).buffer}function k(t,e){return r(t>=0),r(e>0),t+(e-1)&~(e-1)}function U(t,e,r){let s;if(t instanceof ArrayBuffer)s=new Uint8Array(t);else{const e=t.byteOffset,r=t.byteLength;s=new Uint8Array(t.buffer||t.arrayBuffer,e,r)}return e.set(s,r),r+k(s.byteLength,4)}function D(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class B{constructor(t,e){this.name=t,this.type=e,this.sampleSize=1,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=D(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(D()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class F{constructor({id:t,stats:e}){this.id=t,this.stats={},this._initializeStats(e),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(t=[]){t.forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:r}=t;return this.stats[e]||(this.stats[e]=t instanceof B?t:new B(e,r)),this.stats[e]}}const j={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class V{constructor(t={}){g(this,"props",void 0),g(this,"stats",void 0),g(this,"activeRequestCount",0),g(this,"requestQueue",[]),g(this,"requestMap",new Map),g(this,"deferredUpdate",null),this.props={...j,...t},this.stats=new F({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:e},s=new Promise((t=>(r.resolve=t,r)));return this.requestQueue.push(r),this.requestMap.set(t,s),this._issueNewRequests(),s}_issueRequest(t){const{handle:e,resolve:r}=t;let s=!1;const i=()=>{s||(s=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0&&(t.resolve(null),1))}}function q(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const z={},G=t=>"function"==typeof t,H=t=>null!==t&&"object"==typeof t,W=t=>H(t)&&t.constructor==={}.constructor,$=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,K=t=>"undefined"!=typeof Blob&&t instanceof Blob,Q=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||H(t)&&G(t.tee)&&G(t.cancel)&&G(t.getReader))(t)||(t=>H(t)&&G(t.read)&&G(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t),X=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Y=/^([-\w.]+\/[-\w.+]+)/;function Z(t){const e=Y.exec(t);return e?e[1]:t}function J(t){const e=X.exec(t);return e?e[1]:""}const tt=/\?.*/;function et(t){if($(t)){const e=rt(t.url||"");return{url:e,type:Z(t.headers.get("content-type")||"")||J(e)}}return K(t)?{url:rt(t.name||""),type:t.type||""}:"string"==typeof t?{url:rt(t),type:J(t)}:{url:"",type:""}}function rt(t){return t.replace(tt,"")}async function st(t){if($(t))return t;const e={},r=function(t){return $(t)?t.headers["content-length"]||-1:K(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);r>=0&&(e["content-length"]=String(r));const{url:s,type:i}=et(t);i&&(e["content-type"]=i);const n=await async function(t){if("string"==typeof t)return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const r=new FileReader;r.onload=e=>{var r;return t(null==e||null===(r=e.target)||void 0===r?void 0:r.result)},r.readAsDataURL(e)}))}return t instanceof ArrayBuffer?`data:base64,${function(t){let e="";const r=new Uint8Array(t);for(let t=0;t<r.byteLength;t++)e+=String.fromCharCode(r[t]);return btoa(e)}(t.slice(0,5))}`:null}(t);n&&(e["x-first-bytes"]=n),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:s}),o}async function it(t,e){if("string"==typeof t){t=function(t){for(const e in z)if(t.startsWith(e)){const r=z[e];t=t.replace(e,r)}return t.startsWith("http://")||t.startsWith("https://")||(t=`${t}`),t}(t);let r=e;return null!=e&&e.fetch&&"function"!=typeof(null==e?void 0:e.fetch)&&(r=e.fetch),await fetch(t,r)}return await st(t)}const nt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},ot=nt.window||nt.self||nt.global,at=nt.process||{},ct="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",ht=!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}();class ut{constructor(t,e,r="sessionStorage"){this.storage=function(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch(t){return null}}(r),this.id=t,this.config={},Object.assign(this.config,e),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){return this.config={},this.updateConfiguration(t)}updateConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function lt(t,e,r,s=600){const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>s&&(r=Math.min(r,s/t.width));const n=t.width*r,o=t.height*r,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(n,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}const dt={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function ft(t){return"string"==typeof t?dt[t.toUpperCase()]||dt.WHITE:t}function pt(t,e){if(!t)throw new Error(e||"Assertion failed")}function mt(){let t;if(ht&&ot.performance)t=ot.performance.now();else if(at.hrtime){const e=at.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}const gt={debug:ht&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},yt={enabled:!0,level:0};function bt(){}const wt={},Tt={once:!0};function vt(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}class _t{constructor({id:t}={id:""}){this.id=t,this.VERSION=ct,this._startTs=mt(),this._deltaTs=mt(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new ut("__probe-".concat(this.id,"__"),yt),this.userData={},this.timeStamp("".concat(this.id," started")),function(t,e=["constructor"]){const r=Object.getPrototypeOf(t),s=Object.getOwnPropertyNames(r);for(const r of s)"function"==typeof t[r]&&(e.find((t=>r===t))||(t[r]=t[r].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((mt()-this._startTs).toPrecision(10))}getDelta(){return Number((mt()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.updateConfiguration({enabled:t}),this}setLevel(t){return this._storage.updateConfiguration({level:t}),this}assert(t,e){pt(t,e)}warn(t){return this._getLogFunction(0,t,gt.warn,arguments,Tt)}error(t){return this._getLogFunction(0,t,gt.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,gt.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,gt.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,gt.debug||gt.info,arguments,Tt)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||bt,r&&[r],{tag:vt(e)}):bt}image({logLevel:t,priority:e,image:r,message:s="",scale:i=1}){return this._shouldLog(t||e)?ht?function({image:t,message:e="",scale:r=1}){if("string"==typeof t){const s=new Image;return s.onload=()=>{const t=lt(s,e,r);console.log(...t)},s.src=t,bt}const s=t.nodeName||"";if("img"===s.toLowerCase())return console.log(...lt(t,e,r)),bt;if("canvas"===s.toLowerCase()){const s=new Image;return s.onload=()=>console.log(...lt(s,e,r)),s.src=t.toDataURL(),bt}return bt}({image:r,message:s,scale:i}):function({image:t,message:e="",scale:r=1}){let s=null;try{s=module.require("asciify-image")}catch(t){}return s?()=>s(t,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then((t=>console.log(t))):bt}({image:r,message:s,scale:i}):bt}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(t){return this._storage.config[t]}set(t,e){this._storage.updateConfiguration({[t]:e})}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||bt)}group(t,e,r={collapsed:!1}){r=xt({logLevel:t,message:e,opts:r});const{collapsed:s}=r;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,e,r={}){return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||bt)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Et(t)}_getLogFunction(t,e,r,s=[],i){if(this._shouldLog(t)){i=xt({logLevel:t,message:e,args:s,opts:i}),pt(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=mt();const n=i.tag||i.message;if(i.once){if(wt[n])return bt;wt[n]=mt()}return e=function(t,e,r){if("string"==typeof e){const o=r.time?function(t,e=8){const r=Math.max(e-t.length,0);return"".concat(" ".repeat(r)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(r.total)):"";s=e=r.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),i=r.color,n=r.background,ht||"string"!=typeof s||(i&&(i=ft(i),s="[".concat(i,"m").concat(s,"[39m")),n&&(i=ft(n),s="[".concat(n+10,"m").concat(s,"[49m"))),e=s}var s,i,n;return e}(this.id,i.message,i),r.bind(console,e,...i.args)}return bt}}function Et(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return pt(Number.isFinite(e)&&e>=0),e}function xt(t){const{logLevel:e,message:r}=t;t.logLevel=Et(e);const s=t.args?Array.from(t.args):[];for(;s.length&&s.shift()!==r;);switch(t.args=s,typeof e){case"string":case"function":void 0!==r&&s.unshift(r),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const i=typeof t.message;return pt("string"===i||"object"===i),Object.assign(t,t.opts)}_t.VERSION=ct;const St=new _t({id:"loaders.gl"});class Mt{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const At={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){g(this,"console",void 0),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},It={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Rt(){o.loaders=o.loaders||{};const{loaders:t}=o;return t._state=t._state||{},t._state}const Ot=()=>{const t=Rt();return t.globalOptions=t.globalOptions||{...At},t.globalOptions};function Ct(t,e){const r=Ot(),s=t||r;return"function"==typeof s.fetch?s.fetch:H(s.fetch)?t=>it(t,s):null!=e&&e.fetch?null==e?void 0:e.fetch:it}function Lt(t,e,r,s,i){const n=e||"Top level",o=e?`${e}.`:"";for(const a in t){const c=!e&&H(t[a]),h="baseUri"===a&&!e,u="workerUrl"===a&&e;if(!(a in r)&&!h&&!u)if(a in s)St.warn(`${n} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const t=Nt(a,i);St.warn(`${n} loader option '${o}${a}' not recognized. ${t}`)()}}}function Nt(t,e){const r=t.toLowerCase();let s="";for(const i of e)for(const e in i.options){if(t===e)return`Did you mean '${i.id}.${e}'?`;const n=e.toLowerCase();(r.startsWith(n)||n.startsWith(r))&&(s=s||`Did you mean '${i.id}.${e}'?`)}return s}function Pt(t,e){for(const r in e)if(r in e){const s=e[r];W(s)&&W(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function kt(t){var e;return!!t&&(Array.isArray(t)&&(t=t[0]),Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions))}function Ut(t){var e,s;let i;return r(t,"null loader"),r(kt(t),"invalid loader"),Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(s=t)&&void 0!==s&&s.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Dt=/\.([^.]+)$/;function Bt(t,e=[],r,s){if(!Ft(t))return null;if(e&&!Array.isArray(e))return Ut(e);let i=[];e&&(i=i.concat(e)),null!=r&&r.ignoreRegisteredLoaders||i.push(...(()=>{const t=Rt();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry})()),function(t){for(const e of t)Ut(e)}(i);const n=function(t,e,r,s){const{url:i,type:n}=et(t),o=i||(null==s?void 0:s.url);let a=null;return null!=r&&r.mimeType&&(a=Vt(e,null==r?void 0:r.mimeType)),a=a||function(t,e){const r=e&&Dt.exec(e),s=r&&r[1];return s?function(t,e){e=e.toLowerCase();for(const r of t)for(const t of r.extensions)if(t.toLowerCase()===e)return r;return null}(t,s):null}(e,o),a=a||Vt(e,n),a=a||function(t,e){if(!e)return null;for(const r of t)if("string"==typeof e){if(qt(e,r))return r}else if(ArrayBuffer.isView(e)){if(zt(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&zt(e,0,r))return r;return null}(e,t),a=a||Vt(e,null==r?void 0:r.fallbackMimeType),a}(t,i,r,s);if(!(n||null!=r&&r.nothrow))throw new Error(jt(t));return n}function Ft(t){return!(t instanceof Response&&204===t.status)}function jt(t){const{url:e,type:r}=et(t);let s="No valid loader found";return t&&(s+=` data: "${function(t,e=5){return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?Gt(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Gt(t,0,e):""}(t)}", contentType: "${r}"`),e&&(s+=` url: ${e}`),s}function Vt(t,e){for(const r of t){if(r.mimeTypes&&r.mimeTypes.includes(e))return r;if(e===`application/x.${r.id}`)return r}return null}function qt(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function zt(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((s=>function(t,e,r,s){if(s instanceof ArrayBuffer)return function(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const s=new Uint8Array(t),i=new Uint8Array(e);for(let t=0;t<s.length;++t)if(s[t]!==i[t])return!1;return!0}(s,t,s.byteLength);switch(typeof s){case"function":return s(t,r);case"string":return s===Gt(t,e,s.length);default:return!1}}(t,e,r,s)))}function Gt(t,e,r){if(t.byteLength<e+r)return"";const s=new DataView(t);let i="";for(let t=0;t<r;t++)i+=String.fromCharCode(s.getUint8(e+t));return i}const Ht=262144;function Wt(t,e){return a?async function*(t,e){const r=t.getReader();let s;try{for(;;){const t=s||r.read();null!=e&&e._streamReadAhead&&(s=r.read());const{done:i,value:n}=await t;if(i)return;yield N(n)}}catch(t){r.releaseLock()}}(t,e):async function*(t,e){for await(const e of t)yield N(e)}(t)}const $t="Cannot convert supplied data type";async function Kt(t,e,r,s){h(!s||"object"==typeof s),!e||Array.isArray(e)||kt(e)||(s=void 0,r=e,e=void 0),t=await t,r=r||{};const{url:i}=et(t),n=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...t]:t}return r&&r.length?r:null}(e,s),o=await async function(t,e=[],r,s){if(!Ft(t))return null;let i=Bt(t,e,{...r,nothrow:!0},s);if(i)return i;if(K(t)&&(i=Bt(t=await t.slice(0,10).arrayBuffer(),e,r,s)),!(i||null!=r&&r.nothrow))throw new Error(jt(t));return i}(t,n,r);return o?(s=function(t,e,r=null){if(r)return r;const s={fetch:Ct(e,t),...t};return Array.isArray(s.loaders)||(s.loaders=null),s}({url:i,parse:Kt,loaders:n},r=function(t,e,r,s){return r=r||[],function(t,e){Lt(t,null,At,It,e);for(const r of e){const s=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},n=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};Lt(s,r.id,i,n,e)}}(t,r=Array.isArray(r)?r:[r]),function(t,e,r){const s={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(s,r),null===s.log&&(s.log=new Mt),Pt(s,Ot()),Pt(s,e),s}(e,t,s)}(r,o,n,i),s),await async function(t,e,r,s){if(function(t,e="3.0.10"){h(t,"no worker provided"),t.version}(t),e=await async function(t,e,r){const s=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||s)return function(t,e,r){if(e.text&&"string"==typeof t)return t;var s;if((s=t)&&"object"==typeof s&&s.isBuffer&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return 0===t.byteOffset&&s===r.byteLength||(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error($t)}(t,e);if(K(t)&&(t=await st(t)),$(t)){const r=t;return await async function(t){if(!t.ok){const e=await async function(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{const r=t.headers.get("Content-Type");let s=t.statusText;r.includes("application/json")&&(s+=` ${await t.text()}`),e+=s,e=e.length>60?`${e.slice(60)}...`:e}catch(t){}return e}(t);throw new Error(e)}}(r),e.binary?await r.arrayBuffer():await r.text()}if(Q(t)&&(t=function(t,e){if("string"==typeof t)return function*(t,e){const r=(null==e?void 0:e.chunkSize)||262144;let s=0;const i=new TextEncoder;for(;s<t.length;){const e=Math.min(t.length-s,r),n=t.slice(s,s+e);s+=e,yield i.encode(n)}}(t,e);if(t instanceof ArrayBuffer)return function*(t,e={}){const{chunkSize:r=Ht}=e;let s=0;for(;s<t.byteLength;){const e=Math.min(t.byteLength-s,r),i=new ArrayBuffer(e),n=new Uint8Array(t,s,e);new Uint8Array(i).set(n),s+=e,yield i}}(t,e);if(K(t))return async function*(t,e){const r=(null==e?void 0:e.chunkSize)||1048576;let s=0;for(;s<t.size;){const e=s+r,i=await t.slice(s,e).arrayBuffer();s=e,yield i}}(t,e);if(Q(t))return Wt(t,e);if($(t))return Wt(t.body,e);throw new Error("makeIterator")}(t,r)),(i=t)&&"function"==typeof i[Symbol.iterator]||(t=>t&&"function"==typeof t[Symbol.asyncIterator])(t))return async function(t){const e=[];for await(const r of t)e.push(r);return function(...t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),r=e.reduce(((t,e)=>t+e.byteLength),0),s=new Uint8Array(r);let i=0;for(const t of e)s.set(t,i),i+=t.byteLength;return s.buffer}(...e)}(t);var i;throw new Error($t)}(e,t,r),t.parseTextSync&&"string"==typeof e)return r.dataType="text",t.parseTextSync(e,r,s,t);if(function(t,e){return!!M.isSupported()&&t.worker&&(null==e?void 0:e.worker)}(t,r))return await O(t,e,r,0,Kt);if(t.parseText&&"string"==typeof e)return await t.parseText(e,r,s,t);if(t.parse)return await t.parse(e,r,s,t);throw h(!t.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}(o,t,r,s)):null}async function Qt(t,e,r,s){Array.isArray(e)||kt(e)||(r=e,e=void 0);const i=Ct(r);let n=t;return"string"==typeof t&&(n=await i(t)),K(t)&&(n=await i(t)),await Kt(n,e,r)}function Xt(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Yt=1/Math.PI*180,Zt=1/180*Math.PI,Jt={};function te(t,{precision:e=Jt.precision||4}={}){return t=function(t){return Math.round(t/Jt.EPSILON)*Jt.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function ee(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function re(t,e,r){if(ee(t)){r=r||((s=t).clone?s.clone():new Array(s.length));for(let s=0;s<r.length&&s<t.length;++s)r[s]=e(t[s],s,r);return r}var s;return e(t)}function se(t){return function(t,e){return re(t,(t=>t*Zt),void 0)}(t)}function ie(t,e){return re(t,(t=>t*Yt),e)}function ne(t,e,r){const s=Jt.EPSILON;r&&(Jt.EPSILON=r);try{if(t===e)return!0;if(ee(t)&&ee(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!ne(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=Jt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{Jt.EPSILON=s}}Jt.EPSILON=1e-12,Jt.debug=!1,Jt.precision=4,Jt.printTypes=!1,Jt.printDegrees=!1,Jt.printRowMajor=!0;class oe extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return Xt(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}to(t){return t===this?this:ee(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Jt)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+te(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!ne(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){void 0===r&&(r=e,e=t,t=this);for(let s=0;s<this.ELEMENTS;++s){const i=t[s];this[s]=i+r*(e[s]-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(Jt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function ae(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function ce(t,e,r=""){if(Jt.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return t}const he={};function ue(t,e){he[t]||(he[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}class le extends oe{get ELEMENTS(){return Xt(!1),0}copy(t){return Xt(!1),this}get x(){return this[0]}set x(t){this[0]=ae(t)}get y(){return this[1]}set y(t){this[1]=ae(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-t[r];e+=s*s}return ae(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return ae(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Xt(t>=0&&t<this.ELEMENTS,"index is out of range"),ae(this[t])}setComponent(t,e){return Xt(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var de,fe="undefined"!=typeof Float32Array?Float32Array:Array;function pe(t,e,r){var s=e[0],i=e[1];return t[0]=r[0]*s+r[3]*i+r[6],t[1]=r[1]*s+r[4]*i+r[7],t}function me(t,e,r){var s=e[0],i=e[1];return t[0]=r[0]*s+r[4]*i+r[12],t[1]=r[1]*s+r[5]*i+r[13],t}function ge(t,e,r){const s=e[0],i=e[1],n=r[3]*s+r[7]*i||1;return t[0]=(r[0]*s+r[4]*i)/n,t[1]=(r[1]*s+r[5]*i)/n,t}function ye(t,e,r){const s=e[0],i=e[1],n=e[2],o=r[3]*s+r[7]*i+r[11]*n||1;return t[0]=(r[0]*s+r[4]*i+r[8]*n)/o,t[1]=(r[1]*s+r[5]*i+r[9]*n)/o,t[2]=(r[2]*s+r[6]*i+r[10]*n)/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),de=new fe(2),fe!=Float32Array&&(de[0]=0,de[1]=0);class be extends le{constructor(t=0,e=0){super(2),ee(t)&&1===arguments.length?this.copy(t):(Jt.debug&&(ae(t),ae(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Jt.debug&&(ae(t.x),ae(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return me(this,this,t),this.check()}transformAsVector(t){return ge(this,this,t),this.check()}transformByMatrix3(t){return pe(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,r){var s=e[0],i=e[1];t[0]=r[0]*s+r[2]*i+r[4],t[1]=r[1]*s+r[3]*i+r[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,r){var s=e[0],i=e[1];t[0]=r[0]*s+r[2]*i,t[1]=r[1]*s+r[3]*i}(this,this,t),this.check()}}function we(){var t=new fe(3);return fe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Te(t){var e=t[0],r=t[1],s=t[2];return Math.hypot(e,r,s)}function ve(t,e,r){var s=new fe(3);return s[0]=t,s[1]=e,s[2]=r,s}function _e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ee(t,e,r){var s=e[0],i=e[1],n=e[2],o=r[0],a=r[1],c=r[2];return t[0]=i*c-n*a,t[1]=n*o-s*c,t[2]=s*a-i*o,t}function xe(t,e,r){var s=e[0],i=e[1],n=e[2],o=r[3]*s+r[7]*i+r[11]*n+r[15];return o=o||1,t[0]=(r[0]*s+r[4]*i+r[8]*n+r[12])/o,t[1]=(r[1]*s+r[5]*i+r[9]*n+r[13])/o,t[2]=(r[2]*s+r[6]*i+r[10]*n+r[14])/o,t}function Se(t,e,r){var s=e[0],i=e[1],n=e[2];return t[0]=s*r[0]+i*r[3]+n*r[6],t[1]=s*r[1]+i*r[4]+n*r[7],t[2]=s*r[2]+i*r[5]+n*r[8],t}function Me(t,e,r){var s=r[0],i=r[1],n=r[2],o=r[3],a=e[0],c=e[1],h=e[2],u=i*h-n*c,l=n*a-s*h,d=s*c-i*a,f=i*d-n*l,p=n*u-s*d,m=s*l-i*u,g=2*o;return u*=g,l*=g,d*=g,f*=2,p*=2,m*=2,t[0]=a+u+f,t[1]=c+l+p,t[2]=h+d+m,t}function Ae(t,e,r,s){var i=[],n=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],n[0]=i[0],n[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),n[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Ie(t,e,r,s){var i=[],n=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],n[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),n[1]=i[1],n[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Re(t,e,r,s){var i=[],n=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],n[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),n[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),n[2]=i[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Oe(t,e){var r=t[0],s=t[1],i=t[2],n=e[0],o=e[1],a=e[2],c=Math.sqrt(r*r+s*s+i*i)*Math.sqrt(n*n+o*o+a*a),h=c&&_e(t,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))}var Ce=Te;we();const Le=[0,0,0],Ne={};class Pe extends le{static get ZERO(){return Ne.ZERO=Ne.ZERO||Object.freeze(new Pe(0,0,0,0))}constructor(t=0,e=0,r=0){super(-0,-0,-0),1===arguments.length&&ee(t)?this.copy(t):(Jt.debug&&(ae(t),ae(e),ae(r)),this[0]=t,this[1]=e,this[2]=r)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Jt.debug&&(ae(t.x),ae(t.y),ae(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ae(t)}angle(t){return Oe(this,t)}cross(t){return Ee(this,this,t),this.check()}rotateX({radians:t,origin:e=Le}){return Ae(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Le}){return Ie(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Le}){return Re(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return xe(this,this,t),this.check()}transformAsVector(t){return ye(this,this,t),this.check()}transformByMatrix3(t){return Se(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,r){const s=e[0],i=e[1];t[0]=r[0]*s+r[2]*i,t[1]=r[1]*s+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return Me(this,this,t),this.check()}}class ke extends oe{get ELEMENTS(){return Xt(!1),0}get RANK(){return Xt(!1),0}toString(){let t="[";if(Jt.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=ae(r),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[r+t];return e}setColumn(t,e){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)this[r+t]=e[t];return this}}function Ue(t,e,r){var s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],d=r[0],f=r[1],p=r[2],m=r[3],g=r[4],y=r[5],b=r[6],w=r[7],T=r[8];return t[0]=d*s+f*o+p*h,t[1]=d*i+f*a+p*u,t[2]=d*n+f*c+p*l,t[3]=m*s+g*o+y*h,t[4]=m*i+g*a+y*u,t[5]=m*n+g*c+y*l,t[6]=b*s+w*o+T*h,t[7]=b*i+w*a+T*u,t[8]=b*n+w*c+T*l,t}function De(t,e,r){var s=r[0],i=r[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}const Be=Object.freeze([1,0,0,0,1,0,0,0,1]),Fe=Object.freeze([0,0,0,0,0,0,0,0,0]),je=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Ve={};class qe extends ke{static get IDENTITY(){return Ve.IDENTITY=Ve.IDENTITY||Object.freeze(new qe(Be)),Ve.IDENTITY}static get ZERO(){return Ve.ZERO=Ve.ZERO||Object.freeze(new qe(Fe)),Ve.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return je}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}set(t,e,r,s,i,n,o,a,c){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=i,this[5]=n,this[6]=o,this[7]=a,this[8]=c,this.check()}setRowMajor(t,e,r,s,i,n,o,a,c){return this[0]=t,this[1]=s,this[2]=o,this[3]=e,this[4]=i,this[5]=a,this[6]=r,this[7]=n,this[8]=c,this.check()}determinant(){return e=(t=this)[0],r=t[1],s=t[2],i=t[3],n=t[4],o=t[5],a=t[6],c=t[7],e*((h=t[8])*n-o*c)+r*(-h*i+o*a)+s*(c*i-n*a);var t,e,r,s,i,n,o,a,c,h}identity(){return this.copy(Be)}fromQuaternion(t){return function(t,e){var r=e[0],s=e[1],i=e[2],n=e[3],o=r+r,a=s+s,c=i+i,h=r*o,u=s*o,l=s*a,d=i*o,f=i*a,p=i*c,m=n*o,g=n*a,y=n*c;t[0]=1-l-p,t[3]=u-y,t[6]=d+g,t[1]=u+y,t[4]=1-h-p,t[7]=f-m,t[2]=d-g,t[5]=f+m,t[8]=1-h-l}(this,t),this.check()}transpose(){return function(t,e){if(t===e){var r=e[1],s=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=s,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}invert(){return t=this,r=(e=this)[0],s=e[1],i=e[2],n=e[3],o=e[4],a=e[5],c=e[6],h=e[7],(p=r*(l=(u=e[8])*o-a*h)+s*(d=-u*n+a*c)+i*(f=h*n-o*c))&&(p=1/p,t[0]=l*p,t[1]=(-u*s+i*h)*p,t[2]=(a*s-i*o)*p,t[3]=d*p,t[4]=(u*r-i*c)*p,t[5]=(-a*r+i*n)*p,t[6]=f*p,t[7]=(-h*r+s*c)*p,t[8]=(o*r-s*n)*p),this.check();var t,e,r,s,i,n,o,a,c,h,u,l,d,f,p}multiplyLeft(t){return Ue(this,t,this),this.check()}multiplyRight(t){return Ue(this,this,t),this.check()}rotate(t){return function(t,e,r){var s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],d=Math.sin(r),f=Math.cos(r);t[0]=f*s+d*o,t[1]=f*i+d*a,t[2]=f*n+d*c,t[3]=f*o-d*s,t[4]=f*a-d*i,t[5]=f*c-d*n,t[6]=h,t[7]=u,t[8]=l}(this,this,t),this.check()}scale(t){return Array.isArray(t)?De(this,this,t):De(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,r){var s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],d=r[0],f=r[1];t[0]=s,t[1]=i,t[2]=n,t[3]=o,t[4]=a,t[5]=c,t[6]=d*s+f*o+h,t[7]=d*i+f*a+u,t[8]=d*n+f*c+l}(this,this,t),this.check()}transform(t,e){switch(t.length){case 2:e=pe(e||[-0,-0],t,this);break;case 3:e=Se(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,r){const s=e[0],i=e[1],n=e[2];return t[0]=r[0]*s+r[3]*i+r[6]*n,t[1]=r[1]*s+r[4]*i+r[7]*n,t[2]=r[2]*s+r[5]*i+r[8]*n,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ce(e,t.length),e}transformVector(t,e){return ue("Matrix3.transformVector"),this.transform(t,e)}transformVector2(t,e){return ue("Matrix3.transformVector"),this.transform(t,e)}transformVector3(t,e){return ue("Matrix3.transformVector"),this.transform(t,e)}}function ze(t,e){if(t===e){var r=e[1],s=e[2],i=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=n,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ge(t,e){var r=e[0],s=e[1],i=e[2],n=e[3],o=e[4],a=e[5],c=e[6],h=e[7],u=e[8],l=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],y=e[15],b=r*a-s*o,w=r*c-i*o,T=r*h-n*o,v=s*c-i*a,_=s*h-n*a,E=i*h-n*c,x=u*m-l*p,S=u*g-d*p,M=u*y-f*p,A=l*g-d*m,I=l*y-f*m,R=d*y-f*g,O=b*R-w*I+T*A+v*M-_*S+E*x;return O?(O=1/O,t[0]=(a*R-c*I+h*A)*O,t[1]=(i*I-s*R-n*A)*O,t[2]=(m*E-g*_+y*v)*O,t[3]=(d*_-l*E-f*v)*O,t[4]=(c*M-o*R-h*S)*O,t[5]=(r*R-i*M+n*S)*O,t[6]=(g*T-p*E-y*w)*O,t[7]=(u*E-d*T+f*w)*O,t[8]=(o*I-a*M+h*x)*O,t[9]=(s*M-r*I-n*x)*O,t[10]=(p*_-m*T+y*b)*O,t[11]=(l*T-u*_-f*b)*O,t[12]=(a*S-o*A-c*x)*O,t[13]=(r*A-s*S+i*x)*O,t[14]=(m*w-p*v-g*b)*O,t[15]=(u*v-l*w+d*b)*O,t):null}function He(t){var e=t[0],r=t[1],s=t[2],i=t[3],n=t[4],o=t[5],a=t[6],c=t[7],h=t[8],u=t[9],l=t[10],d=t[11],f=t[12],p=t[13],m=t[14],g=t[15];return(e*o-r*n)*(l*g-d*m)-(e*a-s*n)*(u*g-d*p)+(e*c-i*n)*(u*m-l*p)+(r*a-s*o)*(h*g-d*f)-(r*c-i*o)*(h*m-l*f)+(s*c-i*a)*(h*p-u*f)}function We(t,e,r){var s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],d=e[9],f=e[10],p=e[11],m=e[12],g=e[13],y=e[14],b=e[15],w=r[0],T=r[1],v=r[2],_=r[3];return t[0]=w*s+T*a+v*l+_*m,t[1]=w*i+T*c+v*d+_*g,t[2]=w*n+T*h+v*f+_*y,t[3]=w*o+T*u+v*p+_*b,w=r[4],T=r[5],v=r[6],_=r[7],t[4]=w*s+T*a+v*l+_*m,t[5]=w*i+T*c+v*d+_*g,t[6]=w*n+T*h+v*f+_*y,t[7]=w*o+T*u+v*p+_*b,w=r[8],T=r[9],v=r[10],_=r[11],t[8]=w*s+T*a+v*l+_*m,t[9]=w*i+T*c+v*d+_*g,t[10]=w*n+T*h+v*f+_*y,t[11]=w*o+T*u+v*p+_*b,w=r[12],T=r[13],v=r[14],_=r[15],t[12]=w*s+T*a+v*l+_*m,t[13]=w*i+T*c+v*d+_*g,t[14]=w*n+T*h+v*f+_*y,t[15]=w*o+T*u+v*p+_*b,t}function $e(t,e,r){var s,i,n,o,a,c,h,u,l,d,f,p,m=r[0],g=r[1],y=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],d=e[9],f=e[10],p=e[11],t[0]=s,t[1]=i,t[2]=n,t[3]=o,t[4]=a,t[5]=c,t[6]=h,t[7]=u,t[8]=l,t[9]=d,t[10]=f,t[11]=p,t[12]=s*m+a*g+l*y+e[12],t[13]=i*m+c*g+d*y+e[13],t[14]=n*m+h*g+f*y+e[14],t[15]=o*m+u*g+p*y+e[15]),t}function Ke(t,e,r){var s=r[0],i=r[1],n=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qe(t,e,r,s){var i,n,o,a,c,h,u,l,d,f,p,m,g,y,b,w,T,v,_,E,x,S,M,A,I=s[0],R=s[1],O=s[2],C=Math.hypot(I,R,O);return C<1e-6?null:(I*=C=1/C,R*=C,O*=C,i=Math.sin(r),o=1-(n=Math.cos(r)),a=e[0],c=e[1],h=e[2],u=e[3],l=e[4],d=e[5],f=e[6],p=e[7],m=e[8],g=e[9],y=e[10],b=e[11],w=I*I*o+n,T=R*I*o+O*i,v=O*I*o-R*i,_=I*R*o-O*i,E=R*R*o+n,x=O*R*o+I*i,S=I*O*o+R*i,M=R*O*o-I*i,A=O*O*o+n,t[0]=a*w+l*T+m*v,t[1]=c*w+d*T+g*v,t[2]=h*w+f*T+y*v,t[3]=u*w+p*T+b*v,t[4]=a*_+l*E+m*x,t[5]=c*_+d*E+g*x,t[6]=h*_+f*E+y*x,t[7]=u*_+p*E+b*x,t[8]=a*S+l*M+m*A,t[9]=c*S+d*M+g*A,t[10]=h*S+f*M+y*A,t[11]=u*S+p*M+b*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Xe(t,e,r){var s=Math.sin(r),i=Math.cos(r),n=e[4],o=e[5],a=e[6],c=e[7],h=e[8],u=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*i+h*s,t[5]=o*i+u*s,t[6]=a*i+l*s,t[7]=c*i+d*s,t[8]=h*i-n*s,t[9]=u*i-o*s,t[10]=l*i-a*s,t[11]=d*i-c*s,t}function Ye(t,e,r){var s=Math.sin(r),i=Math.cos(r),n=e[0],o=e[1],a=e[2],c=e[3],h=e[8],u=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*i-h*s,t[1]=o*i-u*s,t[2]=a*i-l*s,t[3]=c*i-d*s,t[8]=n*s+h*i,t[9]=o*s+u*i,t[10]=a*s+l*i,t[11]=c*s+d*i,t}function Ze(t,e,r){var s=Math.sin(r),i=Math.cos(r),n=e[0],o=e[1],a=e[2],c=e[3],h=e[4],u=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*i+h*s,t[1]=o*i+u*s,t[2]=a*i+l*s,t[3]=c*i+d*s,t[4]=h*i-n*s,t[5]=u*i-o*s,t[6]=l*i-a*s,t[7]=d*i-c*s,t}function Je(t,e){var r=e[0],s=e[1],i=e[2],n=e[3],o=r+r,a=s+s,c=i+i,h=r*o,u=s*o,l=s*a,d=i*o,f=i*a,p=i*c,m=n*o,g=n*a,y=n*c;return t[0]=1-l-p,t[1]=u+y,t[2]=d-g,t[3]=0,t[4]=u-y,t[5]=1-h-p,t[6]=f+m,t[7]=0,t[8]=d+g,t[9]=f-m,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tr(t,e,r,s,i,n,o){var a=1/(r-e),c=1/(i-s),h=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*c,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(i+s)*c,t[10]=(o+n)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*h,t[15]=0,t}function er(t,e,r,s,i){var n,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(n=1/(s-i),t[10]=(i+s)*n,t[14]=2*i*s*n):(t[10]=-1,t[14]=-2*s),t}function rr(t,e,r,s,i,n,o){var a=1/(e-r),c=1/(s-i),h=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*a,t[13]=(i+s)*c,t[14]=(o+n)*h,t[15]=1,t}function sr(t,e,r,s){var i,n,o,a,c,h,u,l,d,f,p=e[0],m=e[1],g=e[2],y=s[0],b=s[1],w=s[2],T=r[0],v=r[1],_=r[2];return Math.abs(p-T)<1e-6&&Math.abs(m-v)<1e-6&&Math.abs(g-_)<1e-6?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(u=p-T,l=m-v,d=g-_,i=b*(d*=f=1/Math.hypot(u,l,d))-w*(l*=f),n=w*(u*=f)-y*d,o=y*l-b*u,(f=Math.hypot(i,n,o))?(i*=f=1/f,n*=f,o*=f):(i=0,n=0,o=0),a=l*o-d*n,c=d*i-u*o,h=u*n-l*i,(f=Math.hypot(a,c,h))?(a*=f=1/f,c*=f,h*=f):(a=0,c=0,h=0),t[0]=i,t[1]=a,t[2]=u,t[3]=0,t[4]=n,t[5]=c,t[6]=l,t[7]=0,t[8]=o,t[9]=h,t[10]=d,t[11]=0,t[12]=-(i*p+n*m+o*g),t[13]=-(a*p+c*m+h*g),t[14]=-(u*p+l*m+d*g),t[15]=1,t)}function ir(t,e,r){var s=e[0],i=e[1],n=e[2],o=e[3];return t[0]=r[0]*s+r[4]*i+r[8]*n+r[12]*o,t[1]=r[1]*s+r[5]*i+r[9]*n+r[13]*o,t[2]=r[2]*s+r[6]*i+r[10]*n+r[14]*o,t[3]=r[3]*s+r[7]*i+r[11]*n+r[15]*o,t}var nr;nr=new fe(4),fe!=Float32Array&&(nr[0]=0,nr[1]=0,nr[2]=0,nr[3]=0);const or=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ar=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),cr=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),hr={};class ur extends ke{static get IDENTITY(){return hr.IDENTITY=hr.IDENTITY||Object.freeze(new ur(or)),hr.IDENTITY}static get ZERO(){return hr.ZERO=hr.ZERO||Object.freeze(new ur(ar)),hr.ZERO}get INDICES(){return cr}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,s,i,n,o,a,c,h,u,l,d,f,p,m){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=i,this[5]=n,this[6]=o,this[7]=a,this[8]=c,this[9]=h,this[10]=u,this[11]=l,this[12]=d,this[13]=f,this[14]=p,this[15]=m,this.check()}setRowMajor(t,e,r,s,i,n,o,a,c,h,u,l,d,f,p,m){return this[0]=t,this[1]=i,this[2]=c,this[3]=d,this[4]=e,this[5]=n,this[6]=h,this[7]=f,this[8]=r,this[9]=o,this[10]=u,this[11]=p,this[12]=s,this[13]=a,this[14]=l,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(or)}fromQuaternion(t){return Je(this,t),this.check()}frustum({left:t,right:e,bottom:r,top:s,near:i,far:n}){return n===1/0?ur._computeInfinitePerspectiveOffCenter(this,t,e,r,s,i):tr(this,t,e,r,s,i,n),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,r,s,i,n){const o=2*n/(r-e),a=2*n/(i-s),c=(r+e)/(r-e),h=(i+s)/(i-s),u=-2*n;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=h,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=u,t[15]=0,t}lookAt(t,e,r){return 1===arguments.length&&({eye:t,center:e,up:r}=t),sr(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:r,top:s,near:i=.1,far:n=500}){return rr(this,t,e,r,s,i,n),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:r=1,near:s=.1,far:i=500}){if(t>2*Math.PI)throw Error("radians");const n=t/2,o=r*Math.tan(n),a=o*e;return(new ur).ortho({left:-a,right:a,bottom:-o,top:o,near:s,far:i})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:r=1,near:s=.1,far:i=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return er(this,t,r,s,i),this.check()}determinant(){return He(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),s=1/r[0],i=1/r[1],n=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*i,t[6]=this[6]*n,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*i,t[10]=this[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),s=1/r[0],i=1/r[1],n=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=this[4]*s,t[4]=this[5]*i,t[5]=this[6]*n,t[6]=this[8]*s,t[7]=this[9]*i,t[8]=this[10]*n,t}transpose(){return ze(this,this),this.check()}invert(){return Ge(this,this),this.check()}multiplyLeft(t){return We(this,t,this),this.check()}multiplyRight(t){return We(this,this,t),this.check()}rotateX(t){return Xe(this,this,t),this.check()}rotateY(t){return Ye(this,this,t),this.check()}rotateZ(t){return Ze(this,this,t),this.check()}rotateXYZ([t,e,r]){return this.rotateX(t).rotateY(e).rotateZ(r)}rotateAxis(t,e){return Qe(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?Ke(this,this,t):Ke(this,this,[t,t,t]),this.check()}translate(t){return $e(this,this,t),this.check()}transform(t,e){return 4===t.length?(ce(e=ir(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;switch(r){case 2:e=me(e||[-0,-0],t,this);break;case 3:e=xe(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ce(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=ge(e||[-0,-0],t,this);break;case 3:e=ye(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ce(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}transformPoint(t,e){return ue("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return ue("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return ue("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}function lr(){var t=new fe(4);return fe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function dr(t,e,r){r*=.5;var s=Math.sin(r);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(r),t}function fr(t,e,r){var s=e[0],i=e[1],n=e[2],o=e[3],a=r[0],c=r[1],h=r[2],u=r[3];return t[0]=s*u+o*a+i*h-n*c,t[1]=i*u+o*c+n*a-s*h,t[2]=n*u+o*h+s*c-i*a,t[3]=o*u-s*a-i*c-n*h,t}var pr,mr,gr,yr=(pr=we(),mr=ve(1,0,0),gr=ve(0,1,0),function(t,e,r){var s=_e(e,r);return s<-.999999?(Ee(pr,mr,e),Ce(pr)<1e-6&&Ee(pr,gr,e),function(t,e){var r=e[0],s=e[1],i=e[2],n=r*r+s*s+i*i;n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}(pr,pr),dr(t,pr,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ee(pr,e,r),t[0]=pr[0],t[1]=pr[1],t[2]=pr[2],t[3]=1+s,function(t,e){var r=e[0],s=e[1],i=e[2],n=e[3],o=r*r+s*s+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=s*o,t[2]=i*o,t[3]=n*o,t}(t,t))});lr(),lr(),function(){var t=new fe(9);fe!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1}();const br=[0,0,0,1];class wr extends oe{constructor(t=0,e=0,r=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?this.copy(t):this.set(t,e,r,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,r,s){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this.check()}fromMatrix3(t){return function(t,e){var r,s=e[0]+e[4]+e[8];if(s>0)r=Math.sqrt(s+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var n=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+i]+e[3*i+n])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}}(this,t),this.check()}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}fromAxisRotation(t,e){return dr(this,t,e),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=ae(t)}get y(){return this[1]}set y(t){this[1]=ae(t)}get z(){return this[2]}set z(t){this[2]=ae(t)}get w(){return this[3]}set w(t){this[3]=ae(t)}len(){return function(t){var e=t[0],r=t[1],s=t[2],i=t[3];return Math.hypot(e,r,s,i)}(this)}lengthSquared(){return function(t){var e=t[0],r=t[1],s=t[2],i=t[3];return e*e+r*r+s*s+i*i}(this)}dot(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(this,t)}rotationTo(t,e){return yr(this,t,e),this.check()}add(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return function(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3]}(this,this,t),this.check()}calculateW(){return function(t,e){var r=e[0],s=e[1],i=e[2];t[0]=r,t[1]=s,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-s*s-i*i))}(this,this),this.check()}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}invert(){return function(t,e){var r=e[0],s=e[1],i=e[2],n=e[3],o=r*r+s*s+i*i+n*n,a=o?1/o:0;t[0]=-r*a,t[1]=-s*a,t[2]=-i*a,t[3]=n*a}(this,this),this.check()}lerp(t,e,r){return function(t,e,r,s){var i=e[0],n=e[1],o=e[2],a=e[3];t[0]=i+s*(r[0]-i),t[1]=n+s*(r[1]-n),t[2]=o+s*(r[2]-o),t[3]=a+s*(r[3]-a)}(this,t,e,r),this.check()}multiplyRight(t,e){return Xt(!e),fr(this,this,t),this.check()}multiplyLeft(t,e){return Xt(!e),fr(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,r){r*=.5;var s=e[0],i=e[1],n=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);t[0]=s*c+o*a,t[1]=i*c+n*a,t[2]=n*c-i*a,t[3]=o*c-s*a}(this,this,t),this.check()}rotateY(t){return function(t,e,r){r*=.5;var s=e[0],i=e[1],n=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);t[0]=s*c-n*a,t[1]=i*c+o*a,t[2]=n*c+s*a,t[3]=o*c-i*a}(this,this,t),this.check()}rotateZ(t){return function(t,e,r){r*=.5;var s=e[0],i=e[1],n=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);t[0]=s*c+i*a,t[1]=i*c-s*a,t[2]=n*c+o*a,t[3]=o*c-n*a}(this,this,t),this.check()}scale(t){return function(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r}(this,this,t),this.check()}slerp(t,e,r){switch(arguments.length){case 1:({start:t=br,target:e,ratio:r}=arguments[0]);break;case 2:[e,r]=arguments,t=this}return function(t,e,r,s){var i,n,o,a,c,h=e[0],u=e[1],l=e[2],d=e[3],f=r[0],p=r[1],m=r[2],g=r[3];(n=h*f+u*p+l*m+d*g)<0&&(n=-n,f=-f,p=-p,m=-m,g=-g),1-n>1e-6?(i=Math.acos(n),o=Math.sin(i),a=Math.sin((1-s)*i)/o,c=Math.sin(s*i)/o):(a=1-s,c=s),t[0]=a*h+c*f,t[1]=a*u+c*p,t[2]=a*l+c*m,t[3]=a*d+c*g}(this,t,e,r),this.check()}transformVector4(t,e=t){return function(t,e,r){var s=e[0],i=e[1],n=e[2],o=r[0],a=r[1],c=r[2],h=r[3],u=h*s+a*n-c*i,l=h*i+c*s-o*n,d=h*n+o*i-a*s,f=-o*s-a*i-c*n;t[0]=u*h+f*-o+l*-c-d*-a,t[1]=l*h+f*-a+d*-o-u*-c,t[2]=d*h+f*-c+u*-a-l*-o,t[3]=e[3]}(e,t,this),ce(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t,e){return this.multiplyLeft(t,e)}multiply(t,e){return this.multiplyRight(t,e)}}function Tr(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}const vr=1/Math.PI*180,_r=1/180*Math.PI,Er={};function xr(t,{precision:e=Er.precision||4}={}){return t=function(t){return Math.round(t/Er.EPSILON)*Er.EPSILON}(t),`${parseFloat(t.toPrecision(e))}`}function Sr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Mr(t,e,r){if(Sr(t)){r=r||((s=t).clone?s.clone():new Array(s.length));for(let s=0;s<r.length&&s<t.length;++s)r[s]=e(t[s],s,r);return r}var s;return e(t)}function Ar(t){return function(t,e){return Mr(t,(t=>t*_r),void 0)}(t)}function Ir(t){return function(t,e){return Mr(t,(t=>t*vr),void 0)}(t)}function Rr(t,e,r){const s=Er.EPSILON;r&&(Er.EPSILON=r);try{if(t===e)return!0;if(Sr(t)&&Sr(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!Rr(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=Er.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{Er.EPSILON=s}}Er.EPSILON=1e-12,Er.debug=!1,Er.precision=4,Er.printTypes=!1,Er.printDegrees=!1,Er.printRowMajor=!0;class Or extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return Tr(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}to(t){return t===this?this:Sr(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Er)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+xr(this[r],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Rr(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){void 0===r&&(r=e,e=t,t=this);for(let s=0;s<this.ELEMENTS;++s){const i=t[s];this[s]=i+r*(e[s]-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(Er.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function Cr(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${t}`);return t}function Lr(t,e,r=""){if(Er.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}const Nr={};function Pr(t,e){Nr[t]||(Nr[t]=!0,console.warn(`${t} has been removed in version ${e}, see upgrade guide for more information`))}class kr extends Or{get ELEMENTS(){return Tr(!1),0}copy(t){return Tr(!1),this}get x(){return this[0]}set x(t){this[0]=Cr(t)}get y(){return this[1]}set y(t){this[1]=Cr(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-t[r];e+=s*s}return Cr(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Cr(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Tr(t>=0&&t<this.ELEMENTS,"index is out of range"),Cr(this[t])}setComponent(t,e){return Tr(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}function Ur(t,e,r){const s=e[0],i=e[1],n=e[2],o=r[3]*s+r[7]*i+r[11]*n||1;return t[0]=(r[0]*s+r[4]*i+r[8]*n)/o,t[1]=(r[1]*s+r[5]*i+r[9]*n)/o,t[2]=(r[2]*s+r[6]*i+r[10]*n)/o,t}const Dr=[0,0,0],Br={};class Fr extends kr{static get ZERO(){return Br.ZERO=Br.ZERO||Object.freeze(new Fr(0,0,0,0))}constructor(t=0,e=0,r=0){super(-0,-0,-0),1===arguments.length&&Sr(t)?this.copy(t):(Er.debug&&(Cr(t),Cr(e),Cr(r)),this[0]=t,this[1]=e,this[2]=r)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Er.debug&&(Cr(t.x),Cr(t.y),Cr(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Cr(t)}angle(t){return Oe(this,t)}cross(t){return Ee(this,this,t),this.check()}rotateX({radians:t,origin:e=Dr}){return Ae(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Dr}){return Ie(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Dr}){return Re(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return xe(this,this,t),this.check()}transformAsVector(t){return Ur(this,this,t),this.check()}transformByMatrix3(t){return Se(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,r){const s=e[0],i=e[1];t[0]=r[0]*s+r[2]*i,t[1]=r[1]*s+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return Me(this,this,t),this.check()}}class jr extends Or{get ELEMENTS(){return Tr(!1),0}get RANK(){return Tr(!1),0}toString(){let t="[";if(Er.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=` ${this[r*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=Cr(r),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[r+t];return e}setColumn(t,e){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)this[r+t]=e[t];return this}}const Vr=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),qr=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),zr=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Gr={};class Hr extends jr{static get IDENTITY(){return Gr.IDENTITY=Gr.IDENTITY||Object.freeze(new Hr(Vr)),Gr.IDENTITY}static get ZERO(){return Gr.ZERO=Gr.ZERO||Object.freeze(new Hr(qr)),Gr.ZERO}get INDICES(){return zr}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,s,i,n,o,a,c,h,u,l,d,f,p,m){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=i,this[5]=n,this[6]=o,this[7]=a,this[8]=c,this[9]=h,this[10]=u,this[11]=l,this[12]=d,this[13]=f,this[14]=p,this[15]=m,this.check()}setRowMajor(t,e,r,s,i,n,o,a,c,h,u,l,d,f,p,m){return this[0]=t,this[1]=i,this[2]=c,this[3]=d,this[4]=e,this[5]=n,this[6]=h,this[7]=f,this[8]=r,this[9]=o,this[10]=u,this[11]=p,this[12]=s,this[13]=a,this[14]=l,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Vr)}fromQuaternion(t){return Je(this,t),this.check()}frustum({left:t,right:e,bottom:r,top:s,near:i,far:n}){return n===1/0?Hr._computeInfinitePerspectiveOffCenter(this,t,e,r,s,i):tr(this,t,e,r,s,i,n),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,r,s,i,n){const o=2*n/(r-e),a=2*n/(i-s),c=(r+e)/(r-e),h=(i+s)/(i-s),u=-2*n;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=h,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=u,t[15]=0,t}lookAt(t,e,r){return 1===arguments.length&&({eye:t,center:e,up:r}=t),sr(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:r,top:s,near:i=.1,far:n=500}){return rr(this,t,e,r,s,i,n),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:r=1,near:s=.1,far:i=500}){if(t>2*Math.PI)throw Error("radians");const n=t/2,o=r*Math.tan(n),a=o*e;return(new Hr).ortho({left:-a,right:a,bottom:-o,top:o,near:s,far:i})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:r=1,near:s=.1,far:i=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return er(this,t,r,s,i),this.check()}determinant(){return He(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),s=1/r[0],i=1/r[1],n=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*i,t[6]=this[6]*n,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*i,t[10]=this[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),s=1/r[0],i=1/r[1],n=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=this[4]*s,t[4]=this[5]*i,t[5]=this[6]*n,t[6]=this[8]*s,t[7]=this[9]*i,t[8]=this[10]*n,t}transpose(){return ze(this,this),this.check()}invert(){return Ge(this,this),this.check()}multiplyLeft(t){return We(this,t,this),this.check()}multiplyRight(t){return We(this,this,t),this.check()}rotateX(t){return Xe(this,this,t),this.check()}rotateY(t){return Ye(this,this,t),this.check()}rotateZ(t){return Ze(this,this,t),this.check()}rotateXYZ([t,e,r]){return this.rotateX(t).rotateY(e).rotateZ(r)}rotateAxis(t,e){return Qe(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?Ke(this,this,t):Ke(this,this,[t,t,t]),this.check()}translate(t){return $e(this,this,t),this.check()}transform(t,e){return 4===t.length?(Lr(e=ir(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;switch(r){case 2:e=me(e||[-0,-0],t,this);break;case 3:e=xe(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Lr(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=function(t,e,r){const s=e[0],i=e[1],n=r[3]*s+r[7]*i||1;return t[0]=(r[0]*s+r[4]*i)/n,t[1]=(r[1]*s+r[5]*i)/n,t}(e||[-0,-0],t,this);break;case 3:e=Ur(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Lr(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}transformPoint(t,e){return Pr("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return Pr("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return Pr("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}Math.PI,Math.PI,Math.PI,Math.PI;const Wr=t=>t,$r=new Fr,Kr=new Fr,Qr=new Fr,Xr=new Fr,Yr=new Fr,Zr={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Jr={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},ts={east:new Fr,north:new Fr,up:new Fr,west:new Fr,south:new Fr,down:new Fr},es=new Fr,rs=new Fr,ss=new Fr;function is(t,e,r,s,i,n){const o=Zr[e]&&Zr[e][r];let a,c,h;Tr(o&&(!s||s===o));const u=Yr.copy(i);if(Rr(u.x,0,1e-14)&&Rr(u.y,0,1e-14)){const t=Math.sign(u.z);a=es.fromArray(Jr[e]),"east"!==e&&"west"!==e&&a.scale(t),c=rs.fromArray(Jr[r]),"east"!==r&&"west"!==r&&c.scale(t),h=ss.fromArray(Jr[s]),"east"!==s&&"west"!==s&&h.scale(t)}else{const{up:i,east:n,north:o}=ts;n.set(-u.y,u.x,0).normalize(),t.geodeticSurfaceNormal(u,i),o.copy(i).cross(n);const{down:l,west:d,south:f}=ts;l.copy(i).scale(-1),d.copy(n).scale(-1),f.copy(o).scale(-1),a=ts[e],c=ts[r],h=ts[s]}return n[0]=a.x,n[1]=a.y,n[2]=a.z,n[3]=0,n[4]=c.x,n[5]=c.y,n[6]=c.z,n[7]=0,n[8]=h.x,n[9]=h.y,n[10]=h.z,n[11]=0,n[12]=u.x,n[13]=u.y,n[14]=u.z,n[15]=1,n}const ns=new Fr,os=new Fr,as=new Fr,cs=new Fr,hs=new Fr,us=new Fr;let ls;class ds{static get WGS84(){return ls=ls||new ds(6378137,6378137,6356752.314245179),ls}constructor(t=0,e=0,r=0){Tr(t>=0),Tr(e>=0),Tr(r>=0),this.radii=new Fr(t,e,r),this.radiiSquared=new Fr(t*t,e*e,r*r),this.radiiToTheFourth=new Fr(t*t*t*t,e*e*e*e,r*r*r*r),this.oneOverRadii=new Fr(0===t?0:1/t,0===e?0:1/e,0===r?0:1/r),this.oneOverRadiiSquared=new Fr(0===t?0:1/(t*t),0===e?0:1/(e*e),0===r?0:1/(r*r)),this.minimumRadius=Math.min(t,e,r),this.maximumRadius=Math.max(t,e,r),this.centerToleranceSquared=.1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const r=os,s=as,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,r),s.copy(this.radiiSquared).scale(r);const n=Math.sqrt(r.dot(s));return s.scale(1/n),r.scale(i),s.add(r),s.to(e)}cartesianToCartographic(t,e=[0,0,0]){us.from(t);const r=this.scaleToGeodeticSurface(us,cs);if(!r)return;const s=this.geodeticSurfaceNormal(r,os),i=hs;return i.copy(us).subtract(r),function(t,e){return function(t,e,r=Wr){return Sr(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}(t,e,Er._cartographicRadians?Wr:Ir)}([Math.atan2(s.y,s.x),Math.asin(s.z),Math.sign(_e(i,us))*Te(i)],e)}eastNorthUpToFixedFrame(t,e=new Hr){return is(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,r,s,i=new Hr){return is(this,t,e,r,s,i)}geocentricSurfaceNormal(t,e=[0,0,0]){return ns.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const r=function(t,e=$r){return function(t,e,r=Wr){return Sr(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}(t,e,Er._cartographicRadians?Wr:Ar)}(t),s=r[0],i=r[1],n=Math.cos(i);return ns.set(n*Math.cos(s),n*Math.sin(s),Math.sin(i)).normalize(),ns.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return ns.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,r=new Fr){const{oneOverRadii:s,oneOverRadiiSquared:i,centerToleranceSquared:n}=e;Kr.from(t);const o=t.x,a=t.y,c=t.z,h=s.x,u=s.y,l=s.z,d=o*o*h*h,f=a*a*u*u,p=c*c*l*l,m=d+f+p,g=Math.sqrt(1/m);if(!Number.isFinite(g))return;const y=Qr;if(y.copy(t).scale(g),m<n)return y.to(r);const b=i.x,w=i.y,T=i.z,v=Xr;v.set(y.x*b*2,y.y*w*2,y.z*T*2);let _,E,x,S,M=(1-g)*t.len()/(.5*v.len()),A=0;do{M-=A,_=1/(1+M*b),E=1/(1+M*w),x=1/(1+M*T);const t=_*_,e=E*E,r=x*x;S=d*t+f*e+p*r-1,A=S/(-2*(d*(t*_)*b+f*(e*E)*w+p*(r*x)*T))}while(Math.abs(S)>1e-12);return Kr.scale([_,E,x]).to(r)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){cs.from(t);const r=cs.x,s=cs.y,i=cs.z,n=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*n.x+s*s*n.y+i*i*n.z);return cs.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return cs.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return cs.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,r=[0,0,0]){Tr(Rr(this.radii.x,this.radii.y,1e-15)),Tr(this.radii.z>0),cs.from(t);const s=cs.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-e))return cs.set(0,0,s).to(r)}}class fs{constructor(t,e,r){this.item=t,this.previous=e,this.next=r}}class ps{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const e=new fs(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}}function ms(t){return null!=t}class gs{constructor(){g(this,"_list",void 0),g(this,"_sentinel",void 0),g(this,"_trimTiles",void 0),this._list=new ps,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;ms(e)&&this._list.splice(this._sentinel,e)}add(t,e,r){ms(e._cacheNode)||(e._cacheNode=this._list.add(e),r&&r(t,e))}unloadTile(t,e,r){const s=e._cacheNode;ms(s)&&(this._list.remove(s),e._cacheNode=void 0,r&&r(t,e))}unloadTiles(t,e){const r=this._trimTiles;this._trimTiles=!1;const s=this._list,i=1024*t.maximumMemoryUsage*1024,n=this._sentinel;let o=s.head;for(;o!==n&&(t.gpuMemoryUsageInBytes>i||r);){const r=o.item;o=o.next,this.unloadTile(t,r,e)}}trim(){this._trimTiles=!0}}const ys=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});new Pe,new Pe;const bs=new Pe,ws=new Pe;class Ts{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new Pe,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=bs.from(e),this.center=(new Pe).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Ts(this.center,this.radius)}union(t){const e=this.center,r=this.radius,s=t.center,i=t.radius,n=bs.copy(s).subtract(e),o=n.magnitude();if(r>=o+i)return this.clone();if(i>=o+r)return t.clone();const a=.5*(r+o+i);return ws.copy(n).scale((-r+a)/o).add(e),this.center.copy(ws),this.radius=a,this}expand(t){const e=(t=bs.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=function(t,e){var r=e[0],s=e[1],i=e[2],n=e[4],o=e[5],a=e[6],c=e[8],h=e[9],u=e[10];return t[0]=Math.hypot(r,s,i),t[1]=Math.hypot(n,o,a),t[2]=Math.hypot(c,h,u),t}(bs,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){return(t=bs.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}intersectPlane(t){const e=this.center,r=this.radius,s=t.normal.dot(e)+t.distance;return s<-r?ys.OUTSIDE:s<r?ys.INTERSECTING:ys.INSIDE}}const vs=new Pe,_s=new Pe,Es=new Pe,xs=new Pe,Ss=new Pe,Ms=new Pe,As=new Pe;class Is{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=(new Pe).from(t),this.halfAxes=new qe(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Pe(t).len(),new Pe(e).len(),new Pe(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),s=new Pe(t).normalize(),i=new Pe(e).normalize(),n=new Pe(r).normalize();return(new wr).fromMatrix3(new qe([...s,...i,...n]))}fromCenterHalfSizeQuaternion(t,e,r){const s=new wr(r),i=(new qe).fromQuaternion(s);return i[0]=i[0]*e[0],i[1]=i[1]*e[0],i[2]=i[2]*e[0],i[3]=i[3]*e[1],i[4]=i[4]*e[1],i[5]=i[5]*e[1],i[6]=i[6]*e[2],i[7]=i[7]*e[2],i[8]=i[8]*e[2],this.center=(new Pe).from(t),this.halfAxes=i,this}clone(){return new Is(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Ts){const e=this.halfAxes,r=e.getColumn(0,Es),s=e.getColumn(1,xs),i=e.getColumn(2,Ss),n=vs.copy(r).add(s).add(i);return t.center.copy(this.center),t.radius=n.magnitude(),t}intersectPlane(t){const e=this.center,r=t.normal,s=this.halfAxes,i=r.x,n=r.y,o=r.z,a=Math.abs(i*s[0]+n*s[1]+o*s[2])+Math.abs(i*s[3]+n*s[4]+o*s[5])+Math.abs(i*s[6]+n*s[7]+o*s[8]),c=r.dot(e)+t.distance;return c<=-a?ys.OUTSIDE:c>=a?ys.INSIDE:ys.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=_s.from(t).subtract(this.center),r=this.halfAxes,s=r.getColumn(0,Es),i=r.getColumn(1,xs),n=r.getColumn(2,Ss),o=s.magnitude(),a=i.magnitude(),c=n.magnitude();s.normalize(),i.normalize(),n.normalize();let h,u=0;return h=Math.abs(e.dot(s))-o,h>0&&(u+=h*h),h=Math.abs(e.dot(i))-a,h>0&&(u+=h*h),h=Math.abs(e.dot(n))-c,h>0&&(u+=h*h),u}computePlaneDistances(t,e,r=[-0,-0]){let s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const n=this.center,o=this.halfAxes,a=o.getColumn(0,Es),c=o.getColumn(1,xs),h=o.getColumn(2,Ss),u=Ms.copy(a).add(c).add(h).add(n),l=As.copy(u).subtract(t);let d=e.dot(l);return s=Math.min(d,s),i=Math.max(d,i),u.copy(n).add(a).add(c).subtract(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),u.copy(n).add(a).subtract(c).add(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),u.copy(n).add(a).subtract(c).subtract(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),n.copy(u).subtract(a).add(c).add(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),n.copy(u).subtract(a).add(c).subtract(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),n.copy(u).subtract(a).subtract(c).add(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),n.copy(u).subtract(a).subtract(c).subtract(h),l.copy(u).subtract(t),d=e.dot(l),s=Math.min(d,s),i=Math.max(d,i),r[0]=s,r[1]=i,r}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Es);e.transformAsPoint(t);const r=this.halfAxes.getColumn(1,xs);r.transformAsPoint(t);const s=this.halfAxes.getColumn(2,Ss);return s.transformAsPoint(t),this.halfAxes=new qe([...e,...r,...s]),this}getTransform(){throw new Error("not implemented")}}const Rs=new Pe,Os=new Pe;class Cs{constructor(t=[0,0,1],e=0){this.normal=new Pe,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Xt(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Rs.from(t),this.normal.from(e).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,e,r,s){return this.normal.set(t,e,r),Xt(ne(this.normal.len(),1)),this.distance=s,this}clone(t){return new Cs(this.normal,this.distance)}equals(t){return ne(this.distance,t.distance)&&ne(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Os.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}projectPointOntoPlane(t,e=[0,0,0]){t=Rs.from(t);const r=this.getPointDistance(t),s=Os.copy(this.normal).scale(r);return t.subtract(s).to(e)}}const Ls=[new Pe([1,0,0]),new Pe([0,1,0]),new Pe([0,0,1])],Ns=new Pe,Ps=new Pe;new Cs(new Pe(1,0,0),0);class ks{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(t=[]){this.planes=t,Xt(this.planes.every((t=>t instanceof Cs)))}fromBoundingSphere(t){this.planes.length=2*Ls.length;const e=t.center,r=t.radius;let s=0;for(const t of Ls){let i=this.planes[s],n=this.planes[s+1];i||(i=this.planes[s]=new Cs),n||(n=this.planes[s+1]=new Cs);const o=Ns.copy(t).scale(-r).add(e);t.dot(o),i.fromPointNormal(o,t);const a=Ns.copy(t).scale(r).add(e),c=Ps.copy(t).negate();c.dot(a),n.fromPointNormal(a,c),s+=2}return this}computeVisibility(t){Xt(t);let e=ys.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case ys.OUTSIDE:return ys.OUTSIDE;case ys.INTERSECTING:e=ys.INTERSECTING}return e}computeVisibilityWithPlaneMask(t,e){if(Xt(t,"boundingVolume is required."),Xt(Number.isFinite(e),"parentPlaneMask is required."),e===ks.MASK_OUTSIDE||e===ks.MASK_INSIDE)return e;let r=ks.MASK_INSIDE;const s=this.planes;for(let i=0;i<this.planes.length;++i){const n=i<31?1<<i:0;if(i<31&&0==(e&n))continue;const o=s[i],a=t.intersectPlane(o);if(a===ys.OUTSIDE)return ks.MASK_OUTSIDE;a===ys.INTERSECTING&&(r|=n)}return r}}const Us=new Pe,Ds=new Pe,Bs=new Pe,Fs=new Pe,js=new Pe;class Vs{constructor(t={}){t={near:1,far:5e8,...t},this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this._cullingVolume=new ks([new Cs,new Cs,new Cs,new Cs,new Cs,new Cs]),this._perspectiveMatrix=new ur,this._infinitePerspective=new ur}clone(){return new Vs({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Vs&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return qs(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return qs(this),this._infinitePerspective}computeCullingVolume(t,e,r){Xt(t,"position is required."),Xt(e,"direction is required."),Xt(r,"up is required.");const s=this._cullingVolume.planes;r=Us.copy(r).normalize();const i=Ds.copy(e).cross(r).normalize(),n=Bs.copy(e).multiplyByScalar(this.near).add(t),o=Fs.copy(e).multiplyByScalar(this.far).add(t);let a=js;return a.copy(i).multiplyByScalar(this.left).add(n).subtract(t).cross(r),s[0].fromPointNormal(t,a),a.copy(i).multiplyByScalar(this.right).add(n).subtract(t).cross(r).negate(),s[1].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.bottom).add(n).subtract(t).cross(i).negate(),s[2].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.top).add(n).subtract(t).cross(i),s[3].fromPointNormal(t,a),a=(new Pe).copy(e),s[4].fromPointNormal(n,a),a.negate(),s[5].fromPointNormal(o,a),this._cullingVolume}getPixelDimensions(t,e,r,s){qs(this),Xt(Number.isFinite(t)&&Number.isFinite(e)),Xt(t>0),Xt(e>0),Xt(r>0),Xt(s);const i=1/this.near;let n=this.top*i;const o=2*r*n/e;n=this.right*i;const a=2*r*n/t;return s.x=a,s.y=o,s}}function qs(t){Xt(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));const{top:e,bottom:r,right:s,left:i,near:n,far:o}=t;e===t._top&&r===t._bottom&&i===t._left&&s===t._right&&n===t._near&&o===t._far||(Xt(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=s,t._top=e,t._bottom=r,t._near=n,t._far=o,t._perspectiveMatrix=(new ur).frustum({left:i,right:s,bottom:r,top:e,near:n,far:o}),t._infinitePerspective=(new ur).frustum({left:i,right:s,bottom:r,top:e,near:n,far:1/0}))}class zs{constructor(t={}){t={near:1,far:5e8,xOffset:0,yOffset:0,...t},this._offCenterFrustum=new Vs,this.fov=t.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=t.aspectRatio,this._aspectRatio=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this.xOffset=t.xOffset,this._xOffset=this.xOffset,this.yOffset=t.yOffset,this._yOffset=this.yOffset}clone(){return new zs({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return null!=t&&t instanceof zs&&(Gs(this),Gs(t),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return Gs(this),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return Gs(this),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return Gs(this),this._fovy}get sseDenominator(){return Gs(this),this._sseDenominator}computeCullingVolume(t,e,r){return Gs(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}getPixelDimensions(t,e,r,s){return Gs(this),this._offCenterFrustum.getPixelDimensions(t,e,r,s)}}function Gs(t){Xt(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));const e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(Xt(t.fov>=0&&t.fov<Math.PI),Xt(t.aspectRatio>0),Xt(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new qe,new qe,new qe,new qe,new qe,new Pe,new Pe,new Pe,new Pe,new Pe,new qe,new qe,new qe;const Hs=new Pe,Ws=new Pe,$s=new ks([new Cs,new Cs,new Cs,new Cs,new Cs,new Cs]);function Ks(t,e){const{cameraDirection:r,cameraUp:s,height:i}=t,{metersPerUnit:n}=t.distanceScales,o=[t.longitude,t.latitude,0],a=ds.WGS84.cartographicToCartesian(o,new Pe),c=ds.WGS84.eastNorthUpToFixedFrame(a),h=t.unprojectPosition(t.cameraPosition),u=ds.WGS84.cartographicToCartesian(h,new Pe),l=new Pe(c.transformAsVector(new Pe(r).scale(n))).normalize(),d=new Pe(c.transformAsVector(new Pe(s).scale(n))).normalize();return function(t,e){const r=t.getFrustumPlanes();let s=0;for(const i in r){const n=r[i],o=n.normal.dot(t.center);Ws.copy(n.normal).scale(n.distance-o).add(t.center);const a=t.unprojectPosition(Ws),c=ds.WGS84.cartographicToCartesian(a,new Pe);$s.planes[s++].fromPointNormal(c,Hs.copy(e).subtract(c))}}(t,a),{camera:{position:u,direction:l,up:d},viewport:t,height:i,cullingVolume:$s,frameNumber:e,sseDenominator:1.15}}const Qs=new Pe,Xs="scenegraph",Ys="pointcloud",Zs="I3S",Js="TILES3D",ti="geometricError";function ei(t){return null!=t}const ri=new Pe,si=new Pe,ii=new Pe;function ni(t,e,s){if(r(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){const s=new Pe(t[0],t[1],t[2]);e.transform(s,s);let i=[];if(10===t.length){const e=t.slice(3,6),r=new wr;r.fromArray(t,6);const s=new Pe([1,0,0]),n=new Pe([0,1,0]),o=new Pe([0,0,1]);s.transformByQuaternion(r),s.scale(e[0]),n.transformByQuaternion(r),n.scale(e[1]),o.transformByQuaternion(r),o.scale(e[2]),i=[...s.toArray(),...n.toArray(),...o.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const n=e.transformAsVector(i.slice(0,3)),o=e.transformAsVector(i.slice(3,6)),a=e.transformAsVector(i.slice(6,9)),c=new qe([n[0],n[1],n[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return ei(r)?(r.center=s,r.halfAxes=c,r):new Is(s,c)}(t.box,e,s);if(t.region){const[e,r,s,i,n,o]=t.region,a=ds.WGS84.cartographicToCartesian([ie(e),ie(i),n],si),c=ds.WGS84.cartographicToCartesian([ie(s),ie(r),o],ii),h=(new Pe).addVectors(a,c).multiplyScalar(.5),u=(new Pe).subVectors(a,c).len()/2;return oi([h[0],h[1],h[2],u],new ur)}if(t.sphere)return oi(t.sphere,e,s);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function oi(t,e,r){const s=new Pe(t[0],t[1],t[2]);e.transform(s,s);const i=e.getScale(ri),n=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*n;return ei(r)?(r.center=s,r.radius=o,r):new Ts(s,o)}new Pe,new Pe,new ur,new Pe,new Pe,new Pe;const ai=Math.PI/2;function ci([t,e,r]){const s=se(t),i=se(e),n=1+r/6378137,o=n*Math.cos(i);return[t=o*Math.cos(s),e=o*Math.sin(s),r=n*Math.sin(i)]}function hi(t,e){const[r,s,i=0]=t,[n,o,a=0]=e,c=ci([n,o,a]),h=ci([r,s,i]),u=h[0]-c[0],l=h[1]-c[1],d=h[2]-c[2];return u*u+l*l+d*d}function ui(t,e){const r=e.viewport,s=t.header.mbs[1],i=[t.header.mbs[0],s,t.header.mbs[2]],n=t.header.mbs[3]/6378137,o=hi(r.unprojectPosition(r.cameraPosition),i)-n*n;return o<=0?170141175e30:function(t){const{projectionMatrix:e}=t.viewport;return e[5]}(e)*n/Math.sqrt(o)*300}class li{constructor(t=0){this._array=new Array(t),this._map=new Map,this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return r(t<this._array.length),this._array[t]}set(t,e){r(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){r(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){r(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const di={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class fi{constructor(t){g(this,"options",void 0),g(this,"root",void 0),g(this,"requestedTiles",void 0),g(this,"selectedTiles",void 0),g(this,"emptyTiles",void 0),g(this,"_traversalStack",void 0),g(this,"_emptyTraversalStack",void 0),g(this,"_frameNumber",void 0),this.options={...di,...t},this._traversalStack=new li,this._emptyTraversalStack=new li,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(t,e,r){this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){const t=r.pop();let s=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),s=this.updateAndPushChildren(t,e,r,t.hasRenderContent?t._selectionDepth+1:t._selectionDepth));const i=t.parent,n=Boolean(!i||i._shouldRefine),o=!s;t.hasRenderContent?1===t.refine?(this.loadTile(t,e),this.selectTile(t,e)):2===t.refine&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=s&&n}this.options.onTraversalEnd(e)}updateChildTiles(t,e){const r=t.children;for(const t of r)this.updateTile(t,e);return!0}updateAndPushChildren(t,e,r,s){const{loadSiblings:i,skipLevelOfDetail:n}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const a=2===t.refine&&t.hasRenderContent&&!n;let c=!1,h=!0;for(const t of o)if(t._selectionDepth=s,t.isVisibleAndInRequestVolume?(r.find(t)&&r.delete(t),r.push(t),c=!0):(a||i)&&(this.loadTile(t,e),this.touchTile(t,e)),a){let r;if(r=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),h=h&&r,!h)return!1}return c||(h=!1),h}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e,r=!1,s=!1){return!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:!(!s&&!t.isVisibleAndInRequestVolume)&&this.shouldRefine(t,e,r))}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,r){let s=t._screenSpaceError;return r&&(s=t.getScreenSpaceError(e,!0)),s>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const r=[];if(this.options.viewportTraversersMap)for(const t in this.options.viewportTraversersMap)this.options.viewportTraversersMap[t]===e.viewport.id&&r.push(t);else r.push(e.viewport.id);t.updateVisibility(e,r)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let r=!1;for(const s of t.children)s.updateVisibility(e),r=r||s.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,e){let r=!0;const s=this._emptyTraversalStack;for(s.push(t);s.length>0&&r;){const t=s.pop();if(this.updateTile(t,e),t.isVisibleAndInRequestVolume||this.loadTile(t,e),this.touchTile(t,e),!t.hasRenderContent&&this.canTraverse(t,e,!1,!0)){const e=t.children;for(const t of e)s.find(t)&&s.delete(t),s.push(t)}else t.contentAvailable||(r=!1)}return r}}const pi=new Pe;class mi{constructor(t,e,r,s=""){g(this,"tileset",void 0),g(this,"header",void 0),g(this,"id",void 0),g(this,"url",void 0),g(this,"parent",void 0),g(this,"refine",void 0),g(this,"type",void 0),g(this,"contentUrl",void 0),g(this,"lodMetricType",void 0),g(this,"lodMetricValue",void 0),g(this,"boundingVolume",void 0),g(this,"content",void 0),g(this,"contentState",void 0),g(this,"gpuMemoryUsageInBytes",void 0),g(this,"children",void 0),g(this,"depth",void 0),g(this,"viewportIds",void 0),g(this,"transform",void 0),g(this,"userData",void 0),g(this,"computedTransform",void 0),g(this,"hasEmptyContent",void 0),g(this,"hasTilesetContent",void 0),g(this,"traverser",void 0),g(this,"_cacheNode",void 0),g(this,"_frameNumber",void 0),g(this,"_lodJudge",void 0),g(this,"_expireDate",void 0),g(this,"_expiredContent",void 0),g(this,"_shouldRefine",void 0),g(this,"_distanceToCamera",void 0),g(this,"_centerZDepth",void 0),g(this,"_screenSpaceError",void 0),g(this,"_visibilityPlaneMask",void 0),g(this,"_visible",void 0),g(this,"_inRequestVolume",void 0),g(this,"_stackLength",void 0),g(this,"_selectionDepth",void 0),g(this,"_touchedFrame",void 0),g(this,"_visitedFrame",void 0),g(this,"_selectedFrame",void 0),g(this,"_requestedFrame",void 0),g(this,"_priority",void 0),g(this,"_contentBoundingVolume",void 0),g(this,"_viewerRequestVolume",void 0),g(this,"_initialTransform",void 0),this.header=e,this.tileset=t,this.id=s||e.id,this.url=e.url,this.parent=r,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new fi({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new ur,this.transform=new ur,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get contentFailed(){return 5===this.contentState}getScreenSpaceError(t,e){switch(this.tileset.type){case Zs:return ui(this,t);case Js:return function(t,e,r){const s=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,n=r?i:t.lodMetricValue;if(0===n)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:h}=s.options;let u=n*a*(h||1)/(o*c);return u-=function(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,s=t.dynamicScreenSpaceErrorFactor;return function(t,e){const r=t*e;return 1-Math.exp(-r*r)}(e,r)*s}return 0}(s,o),u}(this,t,e);default:throw new Error("Unsupported tileset type")}}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,r=1===this.refine||e;if(r&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(0===this.contentState)return-1;const s=this.parent,i=!s||r&&0!==this._screenSpaceError&&!s.hasTilesetContent?this._screenSpaceError:s._screenSpaceError,n=t.root?t.root._screenSpaceError:0;return Math.max(n-i,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=0,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,s={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(r.id)}};return this.content=await Qt(e,r,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=3,this._onContentLoaded(),!0}catch(t){throw this.contentState=5,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const r=this.parent,s=r?r._visibilityPlaneMask:ks.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const t=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(t)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,s),this._visible=this._visibilityPlaneMask!==ks.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:r}=t,{boundingVolume:s}=this;return r.computeVisibilityWithPlaneMask(s,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return pi.subVectors(e.center,t.position),t.direction.dot(pi)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=4,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new ur(t.transform):new ur;const e=this.parent,r=this.tileset,s=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new ur(s).multiplyRight(this.transform);const i=e&&e._initialTransform?e._initialTransform.clone():new ur;this._initialTransform=new ur(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ks.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||2}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(t){this.boundingVolume=ni(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=ni(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=ni(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new ur){const e=t.clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){return"i3s"===t?{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}:{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"};var e}}class gi extends fi{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const r=t.children[0];return this.updateTileVisibility(r,e),void(t._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const s=2===t.refine,i=1===t._optimChildrenWithinParent;s&&i&&r&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:r}=t;return!(!r||r.hasTilesetContent||1!==r.refine||this.shouldRefine(t,e,!0))}}class yi{constructor(){g(this,"_statusMap",void 0),this._statusMap={}}add(t,e,r,s){this._statusMap[e]||(this._statusMap[e]={request:t,callback:r,key:e,frameState:s,status:"REQUESTED"},t().then((t=>{this._statusMap[e].status="COMPLETED",this._statusMap[e].callback(t,s)})).catch((t=>{this._statusMap[e].status="ERROR",r(t)})))}update(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}find(t){return this._statusMap[t]}}class bi extends fi{constructor(t){super(t),g(this,"_tileManager",void 0),this._tileManager=new yi}shouldRefine(t,e){return t._lodJudge=function(t,e){const r=e.viewport,s=r.metersPerPixel,i=t.header.mbs[1],n=t.header.mbs[0],o=t.header.mbs[2],a=t.header.mbs[3],{height:c,width:h,latitude:u,longitude:l}=r,d=[l,u],f=[n,i,o],p=[l,i],m=[n,u],g=Math.sqrt(c*c+h*h)*s[0],y=.5*c+a/6378137,b=.5*h+a/6378137;if(hi(d,f)>g+a/6378137)return"OUT";if(hi(d,p)>y)return"OUT";if(hi(d,m)>b)return"OUT";if(0===t.lodMetricValue)return"DIG";let w=ui(t,e);return w*=ai,w<.5?"OUT":!t.header.children||w<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const r=t.header.children||[],s=t.children,i=t.tileset;for(const n of r){const r=`${n.id}-${e.viewport.id}`,o=s&&s.find((t=>t.id===r));if(o)o&&this.updateTile(o,e);else{let s=()=>this._loadTile(n.id,i);this._tileManager.find(r)?this._tileManager.update(r,e):(i.tileset.nodePages&&(s=()=>i.tileset.nodePagesTile.formTileFromNodePages(n.id)),this._tileManager.add(s,r,(e=>this._onTileLoad(e,t,r)),e))}}return!1}async _loadTile(t,e){const{loader:r}=e,s=e.getTileUrl(`${e.url}/nodes/${t}`),i={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0,loadContent:!1}};return await Qt(s,r,i)}_onTileLoad(t,e,r){const s=new mi(e.tileset,t,e,r);e.children.push(s);const i=this._tileManager.find(s.id).frameState;this.updateTile(s,i),this._frameNumber===i.frameNumber&&this.executeTraversal(s,i)}}const wi={description:"",ellipsoid:ds.WGS84,modelMatrix:new ur,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}};class Ti{constructor(t,e){g(this,"options",void 0),g(this,"loadOptions",void 0),g(this,"type",void 0),g(this,"tileset",void 0),g(this,"loader",void 0),g(this,"url",void 0),g(this,"basePath",void 0),g(this,"modelMatrix",void 0),g(this,"ellipsoid",void 0),g(this,"lodMetricType",void 0),g(this,"lodMetricValue",void 0),g(this,"refine",void 0),g(this,"root",void 0),g(this,"roots",void 0),g(this,"asset",void 0),g(this,"description",void 0),g(this,"properties",void 0),g(this,"extras",void 0),g(this,"attributions",void 0),g(this,"credits",void 0),g(this,"stats",void 0),g(this,"traverseCounter",void 0),g(this,"geometricError",void 0),g(this,"selectedTiles",void 0),g(this,"cartographicCenter",void 0),g(this,"cartesianCenter",void 0),g(this,"zoom",void 0),g(this,"boundingVolume",void 0),g(this,"gpuMemoryUsageInBytes",void 0),g(this,"dynamicScreenSpaceErrorComputedDensity",void 0),g(this,"_traverser",void 0),g(this,"_cache",void 0),g(this,"_requestScheduler",void 0),g(this,"_frameNumber",void 0),g(this,"_queryParamsString",void 0),g(this,"_queryParams",void 0),g(this,"_extensionsUsed",void 0),g(this,"_tiles",void 0),g(this,"_pendingCount",void 0),g(this,"lastUpdatedVieports",void 0),g(this,"_requestedTiles",void 0),g(this,"_emptyTiles",void 0),g(this,"frameStateData",void 0),g(this,"maximumMemoryUsage",void 0),r(t),this.options={...wi,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||q(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new gs,this._requestScheduler=new V({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new F({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(t){const e=[];for(const r of Object.keys(t))e.push(`${r}=${t[r]}`);switch(e.length){case 0:return"";case 1:return`?${e[0]}`;default:return`?${e.join("&")}`}}(this._queryParams)),this._queryParamsString}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:`${t}${this.queryParams}`}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}update(t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t instanceof Array||(t=[t]),this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const e=[];for(const r of t){const t=r.id;this._needTraverse(t)?e.push(t):this.traverseCounter--}for(const r of t){const t=r.id;if(this.roots[t]||(this.roots[t]=this._initializeTileHeaders(this.tileset,null)),!e.includes(t))continue;const s=Ks(r,this._frameNumber);this._traverser.traverse(this.roots[t],s,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[e],s=Object.values(this._traverser.selectedTiles);r.selectedTiles=s,r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const r=new Set(t.map((t=>t.id))),s=new Set(e.map((t=>t.id)));let i=t.filter((t=>!s.has(t.id))).length>0;return i=i||e.filter((t=>!r.has(t.id))).length>0,i}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,((t,e)=>t._unloadTile(e)))}_updateStats(){let t=0,e=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(t++,r.content.pointCount&&(e+=r.content.pointCount));this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=e}_initializeTileSet(t){this.root=this._initializeTileHeaders(t,null),this.type===Js&&this._initializeCesiumTileset(t),this.type===Zs&&this._initializeI3STileset(),this._calculateViewProps()}_calculateViewProps(){const t=this.root;r(t);const{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Pe,void(this.zoom=1);this.cartographicCenter=ds.WGS84.cartesianToCartographic(e,new Pe),this.cartesianCenter=e,this.zoom=function(t){const{halfAxes:e,radius:r,width:s,height:i}=t;if(e){const t=function(t){t.getColumn(0,Qs);const e=t.getColumn(1),r=t.getColumn(2);return Qs.add(e).add(r).len()}(e);return Math.log2(6356752.314245179/t)}return r?Math.log2(6356752.314245179/r):i&&s?(Math.log2(6378137/s)+Math.log2(6378137/i))/2:1}(t.boundingVolume)}_initializeStats(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}_initializeTileHeaders(t,e){const r=new mi(this,t.root,e);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===Js){const t=[];for(t.push(r);t.length>0;){const e=t.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();const r=e.header.children||[];for(const s of r){const r=new mi(this,s,e);e.children.push(r),r.depth=e.depth+1,t.push(r)}}}return r}_initializeTraverser(){let t;switch(this.type){case Js:t=gi;break;case Zs:t=bi;break;default:t=fi}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(e){this._onTileLoadError(t,e)}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get("Failed Tile Loads").incrementCount();const r=e.message||e.toString(),s=t.url;console.error(`A 3D tile failed to load: ${t.url} ${r}`),this.options.onTileError(t,r,s)}_onTileLoad(t,e){e&&(t&&t.content&&function(t,e){r(t),r(e);const{rtcCenter:s,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:o}}=t;let a=new ur(n);switch(s&&a.translate(s),i){case"Z":break;case"Y":const t=(new ur).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const e=(new ur).rotateY(-Math.PI/2);a=a.multiplyRight(e)}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const c=new Pe(o);e.cartesianModelMatrix=a,e.cartesianOrigin=c;const h=ds.WGS84.cartesianToCartographic(c,new Pe),u=ds.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=u.multiplyRight(a),e.cartographicOrigin=h,e.modelMatrix=e.cartographicModelMatrix}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}_onStartTileLoading(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}_addTileToCache(t){this._cache.add(this,t,(e=>e._updateCacheStats(t)))}_updateCacheStats(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.content&&t.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const r of e.children)t.push(r);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();for(const e of t.children)r.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeCesiumTileset(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}function vi(t,e,s){r(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),n=new Uint8Array(t,e,s);return i.decode(n)}const _i={name:"Draco",id:"draco",module:"draco",version:"3.0.10",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class Ei{constructor(t,e){g(this,"fields",void 0),g(this,"metadata",void 0),function(t,e){if(!t)throw new Error("loader assertion failed.")}(Array.isArray(t)),function(t){const e={};for(const r of t)e[r.name]&&console.warn("Schema: duplicated field name",r.name,r),e[r.name]=!0}(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...t){const e=Object.create(null);for(const r of t)e[r]=!0;const r=this.fields.filter((t=>e[t.name]));return new Ei(r,this.metadata)}selectAt(...t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new Ei(e,this.metadata)}assign(t){let e,r=this.metadata;if(t instanceof Ei){const s=t;e=s.fields,r=xi(xi(new Map,this.metadata),s.metadata)}else e=t;const s=Object.create(null);for(const t of this.fields)s[t.name]=t;for(const t of e)s[t.name]=t;const i=Object.values(s);return new Ei(i,r)}}function xi(t,e){return new Map([...t||new Map,...e||new Map])}class Si{constructor(t,e,r=!1,s=new Map){g(this,"name",void 0),g(this,"type",void 0),g(this,"nullable",void 0),g(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=r,this.metadata=s}get typeId(){return this.type&&this.type.typeId}clone(){return new Si(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?`, metadata: ${this.metadata}`:""}`}}let Mi,Ai,Ii,Ri;!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(Mi||(Mi={}));class Oi{static isNull(t){return t&&t.typeId===Mi.Null}static isInt(t){return t&&t.typeId===Mi.Int}static isFloat(t){return t&&t.typeId===Mi.Float}static isBinary(t){return t&&t.typeId===Mi.Binary}static isUtf8(t){return t&&t.typeId===Mi.Utf8}static isBool(t){return t&&t.typeId===Mi.Bool}static isDecimal(t){return t&&t.typeId===Mi.Decimal}static isDate(t){return t&&t.typeId===Mi.Date}static isTime(t){return t&&t.typeId===Mi.Time}static isTimestamp(t){return t&&t.typeId===Mi.Timestamp}static isInterval(t){return t&&t.typeId===Mi.Interval}static isList(t){return t&&t.typeId===Mi.List}static isStruct(t){return t&&t.typeId===Mi.Struct}static isUnion(t){return t&&t.typeId===Mi.Union}static isFixedSizeBinary(t){return t&&t.typeId===Mi.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Mi.FixedSizeList}static isMap(t){return t&&t.typeId===Mi.Map}static isDictionary(t){return t&&t.typeId===Mi.Dictionary}get typeId(){return Mi.NONE}compareTo(t){return this===t}}Ai=Symbol.toStringTag;class Ci extends Oi{constructor(t,e){super(),g(this,"isSigned",void 0),g(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Mi.Int}get[Ai](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}class Li extends Ci{constructor(){super(!0,8)}}class Ni extends Ci{constructor(){super(!0,16)}}class Pi extends Ci{constructor(){super(!0,32)}}class ki extends Ci{constructor(){super(!1,8)}}class Ui extends Ci{constructor(){super(!1,16)}}class Di extends Ci{constructor(){super(!1,32)}}Ii=Symbol.toStringTag;class Bi extends Oi{constructor(t){super(),g(this,"precision",void 0),this.precision=t}get typeId(){return Mi.Float}get[Ii](){return"Float"}toString(){return`Float${this.precision}`}}class Fi extends Bi{constructor(){super(32)}}class ji extends Bi{constructor(){super(64)}}Ri=Symbol.toStringTag;class Vi extends Oi{constructor(t,e){super(),g(this,"listSize",void 0),g(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Mi.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Ri](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}function qi(t,e,r){const s=r?zi(r.metadata):void 0,i=function(t){switch(t.constructor){case Int8Array:return new Li;case Uint8Array:return new ki;case Int16Array:return new Ni;case Uint16Array:return new Ui;case Int32Array:return new Pi;case Uint32Array:return new Di;case Float32Array:return new Fi;case Float64Array:return new ji;default:throw new Error("array type not supported")}}(e.value);return new Si(t,new Vi(e.size,new Si("value",i)),!1,s)}function zi(t){const e=new Map;for(const r in t)e.set(`${r}.string`,JSON.stringify(t[r]));return e}const Gi={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Hi={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Wi{constructor(t){g(this,"draco",void 0),g(this,"decoder",void 0),g(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const s=this.decoder.GetEncodedGeometryType(r),i=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let t;switch(s){case this.draco.TRIANGULAR_MESH:t=this.decoder.DecodeBufferToMesh(r,i);break;case this.draco.POINT_CLOUD:t=this.decoder.DecodeBufferToPointCloud(r,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!t.ok()||!i.ptr){const e=`DRACO decompression failed: ${t.error_msg()}`;throw new Error(e)}const n=this._getDracoLoaderData(i,s,e),o=this._getMeshData(i,n,e),a=function(t){let e=1/0,r=1/0,s=1/0,i=-1/0,n=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let t=0;t<c;t+=3){const c=a[t],h=a[t+1],u=a[t+2];e=c<e?c:e,r=h<r?h:r,s=u<s?u:s,i=c>i?c:i,n=h>n?h:n,o=u>o?u:o}return[[e,r,s],[i,n,o]]}(o.attributes),c=function(t,e,r){const s=zi(e.metadata),i=[],n=function(t){const e={};for(const r in t){const s=t[r];e[s.name||"undefined"]=s}return e}(e.attributes);for(const e in t){const r=qi(e,t[e],n[e]);i.push(r)}if(r){const t=qi("indices",r);i.push(t)}return new Ei(i,s)}(o.attributes,n,o.indices);return{loader:"draco",loaderData:n,header:{vertexCount:i.num_points(),boundingBox:a},...o,schema:c}}finally{this.draco.destroy(r),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,e,r){const s=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:s,attributes:i}}_getDracoAttributes(t,e){const r={};for(let s=0;s<t.num_attributes();s++){const i=this.decoder.GetAttribute(t,s),n=this._getAttributeMetadata(t,s);r[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:s,metadata:n};const o=this._getQuantizationTransform(i,e);o&&(r[i.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(i,e);a&&(r[i.unique_id()].octahedron_transform=a)}return r}_getMeshData(t,e,r){const s=this._getMeshAttributes(e,t,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(t,e,r){const s={};for(const i of Object.values(t.attributes)){const t=this._deduceAttributeName(i,r);i.name=t;const{value:n,size:o}=this._getAttributeValues(e,i);s[t]={value:n,size:o,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return s}_getTriangleListIndices(t){const e=3*t.num_faces(),r=4*e,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,e).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),function(t){const e=t.size(),r=new Int32Array(e);for(let s=0;s<e;s++)r[s]=t.GetValue(s);return r}(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=Hi[e.data_type],s=e.num_components,i=t.num_points()*s,n=i*r.BYTES_PER_ELEMENT,o=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}(this.draco,r);let a;const c=this.draco._malloc(n);try{const s=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,s,o,n,c),a=new r(this.draco.HEAPF32.buffer,c,i).slice()}finally{this.draco._free(c)}return{value:a,size:s}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[t,s]of Object.entries(e.extraAttributes||{}))if(s===r)return t;const s=t.attribute_type;for(const t in Gi)if(this.draco[t]===s)return Gi[t];const i=e.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let s=0;s<r;s++){const r=this.metadataQuerier.GetEntryName(t,s);e[r]=this._getDracoMetadataField(t,r)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const s=function(t){const e=t.size(),r=new Int32Array(e);for(let s=0;s<e;s++)r[s]=t.GetValue(s);return r}(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,s=[...e,...r];for(const t of s)this.decoder.SkipAttributeTransform(this.draco[t])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,s=t.attribute_type();if(r.map((t=>this.decoder[t])).includes(s)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits(),range:e.range(),min_values:new Float32Array([1,2,3]).map((t=>e.min_value(t)))}}finally{this.draco.destroy(e)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,s=t.attribute_type();if(r.map((t=>this.decoder[t])).includes(s)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits()}}finally{this.draco.destroy(e)}}return null}}let $i;const Ki={..._i,parse:async function(t,e){const{draco:r}=await async function(t){const e=t.modules||{};return $i=e.draco3d?$i||e.draco3d.createDecoderModule({}).then((t=>({draco:t}))):$i||async function(t){let e,r;return"js"===(t.draco&&t.draco.decoderType)?e=await R("https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.js","draco",t):[e,r]=await Promise.all([await R("https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_wasm_wrapper.js","draco",t),await R("https://www.gstatic.com/draco/versioned/decoders/1.4.1/draco_decoder.wasm","draco",t)]),e=e||globalThis.DracoDecoderModule,await function(t,e){const r={};return e&&(r.wasmBinary=e),new Promise((e=>{t({...r,onModuleLoaded:t=>e({draco:t})})}))}(e,r)}(t),await $i}(e),s=new Wi(r);try{return s.parseSync(t,null==e?void 0:e.draco)}finally{s.destroy()}}},Qi={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Xi={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...Qi},Yi={[Qi.DOUBLE]:Float64Array,[Qi.FLOAT]:Float32Array,[Qi.UNSIGNED_SHORT]:Uint16Array,[Qi.UNSIGNED_INT]:Uint32Array,[Qi.UNSIGNED_BYTE]:Uint8Array,[Qi.BYTE]:Int8Array,[Qi.SHORT]:Int16Array,[Qi.INT]:Int32Array},Zi={DOUBLE:Qi.DOUBLE,FLOAT:Qi.FLOAT,UNSIGNED_SHORT:Qi.UNSIGNED_SHORT,UNSIGNED_INT:Qi.UNSIGNED_INT,UNSIGNED_BYTE:Qi.UNSIGNED_BYTE,BYTE:Qi.BYTE,SHORT:Qi.SHORT,INT:Qi.INT};class Ji{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in Yi)if(Yi[e]===t)return e;throw new Error("Failed to convert GL type")}static fromName(t){const e=Zi[t];if(!e)throw new Error("Failed to convert GL type");return e}static getArrayType(t){switch(t){case Qi.UNSIGNED_SHORT_5_6_5:case Qi.UNSIGNED_SHORT_4_4_4_4:case Qi.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=Yi[t];if(!e)throw new Error("Failed to convert GL type");return e}}static getByteSize(t){return Ji.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(Ji.getArrayType(t))}static createTypedArray(t,e,r=0,s){return void 0===s&&(s=(e.byteLength-r)/Ji.getByteSize(t)),new(Ji.getArrayType(t))(e,r,s)}}function tn(t,e=[0,0,0]){const r=t>>11&31,s=t>>5&63,i=31&t;return e[0]=r<<3,e[1]=s<<2,e[2]=i<<3,e}function en(t,e=255){return function(t,e,r){return re(t,(t=>Math.max(0,Math.min(r,t))))}(t,0,e)/e*2-1}function rn(t){return t<0?-1:1}function sn(t,e,r,s){if(function(t,e){if(!t)throw new Error("math.gl assertion failed. undefined")}(s),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(s.x=en(t,r),s.y=en(e,r),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const t=s.x;s.x=(1-Math.abs(s.y))*rn(t),s.y=(1-Math.abs(t))*rn(s.y)}return s.normalize()}new be,new Pe,new be,new be;class nn{constructor(t,e){this.json=t,this.buffer=e,this.featuresLength=0,this._cachedTypedArrays={}}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,e=Xi.UNSIGNED_INT,r=1){const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,s.byteOffset):s}getPropertyArray(t,e,r){const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(e=Ji.fromName(s.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(t,e,s)}getProperty(t,e,r,s,i){const n=this.json[t];if(!n)return n;const o=this.getPropertyArray(t,e,r);if(1===r)return o[s];for(let t=0;t<r;++t)i[t]=o[r*s+t];return i}_getTypedArrayFromBinary(t,e,r,s,i){const n=this._cachedTypedArrays;let o=n[t];return o||(o=Ji.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+i,s*r),n[t]=o),o}_getTypedArrayFromArray(t,e,r){const s=this._cachedTypedArrays;let i=s[t];return i||(i=Ji.createTypedArray(e,r),s[t]=i),i}}const on={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},an={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},cn={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}},hn=t=>void 0!==t;function un(t,e,r){if(!t)return;const s=t.parentCounts;return t.parentIds?r(t,e):s>0?function(t,e,r){const s=t.classIds,i=t.parentCounts,n=t.parentIds,o=t.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const h=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(c[e=u.pop()]===h)continue;c[e]=h;const s=r(t,e);if(hn(s))return s;const a=i[e],l=o[e];for(let t=0;t<a;++t){const r=n[l+t];r!==e&&u.push(r)}}return null}(t,e,r):function(t,e,r){let s=!0;for(;s;){const i=r(t,e);if(hn(i))return i;const n=t.parentIds[e];s=n!==e,e=n}throw new Error("traverseHierarchySingleParent")}(t,e,r)}function ln(t,e,r){const s=t.parentCounts,i=t.parentIds,n=t.parentIndexes,o=t.classIds.length;if(!hn(i))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(-1===r.indexOf(e),"Circular dependency detected in the batch table hierarchy."),r.push(e);const a=hn(s)?s[e]:1,c=hn(s)?n[e]:e;for(let s=0;s<a;++s){const n=i[c+s];n!==e&&ln(t,n,r)}r.pop(e)}function dn(t){return null!=t}const fn=(t,e)=>t,pn={HIERARCHY:!0,extensions:!0,extras:!0};class mn{constructor(t,e,s,i={}){var n;r(s>=0),this.json=t||{},this.binary=e,this.featureCount=s,this._extensions=(null===(n=this.json)||void 0===n?void 0:n.extensions)||{},this._properties={};for(const t in this.json)pn[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(t,e,r){if(!e)return null;let s=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,s=i),s?function(t,e){let r,s,i;const n=t.instancesLength,o=t.classes;let a,c=t.classIds,h=t.parentCounts,u=t.parentIds,l=n;if(hn(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,n)),hn(h))for(hn(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,n)),a=new Uint16Array(n),l=0,r=0;r<n;++r)a[r]=l,l+=h[r];hn(u)&&hn(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,l));const d=o.length;for(r=0;r<d;++r){const t=o[r].length,s=o[r].instances,i=getBinaryProperties(t,s,e);o[r].instances=combine(i,s)}const f=new Array(d).fill(0),p=new Uint16Array(n);for(r=0;r<n;++r)s=c[r],p[r]=f[s],++f[s];const m={classes:o,classIds:c,classIndexes:p,parentCounts:h,parentIndexes:a,parentIds:u};return function(t){const e=t.classIds.length;for(let r=0;r<e;++r)ln(t,r,stack)}(m),m}(s,r):null}(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){return this._checkBatchId(t),r("string"==typeof e,e),!!this._hierarchy&&dn(un(this._hierarchy,t,((t,r)=>{const s=t.classIds[r];return t.classes[s].name===e})))}isExactClass(t,e){return r("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),r("string"==typeof e,e),dn(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=dn(e)?e:[]).length=0;const r=Object.keys(this._properties);return e.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),r("string"==typeof e,e),this._binaryProperties){const r=this._binaryProperties[e];if(dn(r))return this._getBinaryProperty(r,t)}const s=this._properties[e];if(dn(s))return fn(s[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,e);if(dn(r))return r}}setProperty(t,e,s){const i=this.featureCount;if(this._checkBatchId(t),r("string"==typeof e,e),this._binaryProperties){const r=this._binaryProperties[e];if(r)return void this._setBinaryProperty(r,t,s)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,s))return;let n=this._properties[e];dn(n)||(this._properties[e]=new Array(i),n=this._properties[e]),n[t]=fn(s)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,r){t.pack(r,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const r=this._properties[e],s=this._initializeBinaryProperty(e,r);s&&(t=t||{},t[e]=s)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const s=e;r(this.binary,`Property ${t} requires a batch table binary.`),r(s.type,`Property ${t} requires a type.`);const i=function(t,e,s,i){const{componentType:n}=t;r(t.componentType);const o="string"==typeof n?Ji.fromName(n):n,a=on[t.type],c=an[t.type],h=cn[t.type];return s+=t.byteOffset,{values:Ji.createTypedArray(o,e,s,a*i),type:o,size:a,unpacker:c,packer:h}}(s,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const r=un(this._hierarchy,t,((t,r)=>{const s=t.classIds[r];return dn(t.classes[s].instances[e])}));return dn(r)}_getPropertyNamesInHierarchy(t,e){un(this._hierarchy,t,((t,r)=>{const s=t.classIds[r],i=t.classes[s].instances;for(const t in i)i.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)}))}_getHierarchyProperty(t,e){return un(this._hierarchy,t,((t,r)=>{const s=t.classIds[r],i=t.classes[s],n=t.classIndexes[r],o=i.instances[e];return dn(o)?dn(o.typedArray)?this._getBinaryProperty(o,n):fn(o[n]):null}))}_setHierarchyProperty(t,e,s,i){const n=un(this._hierarchy,e,((t,n)=>{const o=t.classIds[n],a=t.classes[o],c=t.classIndexes[n],h=a.instances[s];return!!dn(h)&&(r(n===e,`Inherited property "${s}" is read-only.`),dn(h.typedArray)?this._setBinaryProperty(h,c,i):h[c]=fn(i),!0)}));return dn(n)}}function gn(t,e,r=0){const s=new DataView(e);if(t.magic=s.getUint32(r,!0),r+=4,t.version=s.getUint32(r,!0),r+=4,t.byteLength=s.getUint32(r,!0),r+=4,1!==t.version)throw new Error(`3D Tile Version ${t.version} not supported`);return r}function yn(t,e,r){const s=new DataView(e);let i;t.header=t.header||{};let n=s.getUint32(r,!0);r+=4;let o=s.getUint32(r,!0);r+=4;let a=s.getUint32(r,!0);r+=4;let c=s.getUint32(r,!0);return r+=4,a>=570425344?(r-=8,i=n,a=o,c=0,n=0,o=0,console.warn("b3dm tile in legacy format.")):c>=570425344&&(r-=4,i=a,a=n,c=o,n=0,o=0,console.warn("b3dm tile in legacy format.")),t.header.featureTableJsonByteLength=n,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=i,r}function bn(t,e,r,s){return r=function(t,e,r,s){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:n,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},i>0){const s=vi(e,r,i);t.featureTableJson=JSON.parse(s)}return r+=i,t.featureTableBinary=new Uint8Array(e,r,n),r+n}(t,e,r),function(t,e,r,s){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:n}=t.header;if(i>0){const s=vi(e,r,i);t.batchTableJson=JSON.parse(s),r+=i,n>0&&(t.batchTableBinary=new Uint8Array(e,r,n),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=n)}return r}(t,e,r)}function wn(t,e,r){if(!(e||t&&t.batchIds&&r))return null;const{batchIds:s,isRGB565:i,pointCount:n}=t;if(s&&r){const t=new Uint8ClampedArray(3*n);for(let e=0;e<n;e++){const i=s[e],n=r.getProperty(i,"dimensions").map((t=>255*t));t[3*e]=n[0],t[3*e+1]=n[1],t[3*e+2]=n[2]}return{type:Xi.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(i){const t=new Uint8ClampedArray(3*n);for(let r=0;r<n;r++){const s=tn(e[r]);t[3*r]=s[0],t[3*r+1]=s[1],t[3*r+2]=s[2]}return{type:Xi.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*n?{type:Xi.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Xi.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const Tn=new Pe;function vn(t,e){if(!t)throw new Error(e)}const _n={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},En=_n.global||_n.self||_n.window,xn="object"!=typeof process||"[object process]"!==String(process)||process.browser,Sn="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Sn&&parseFloat(Sn[1]);const{_parseImageNode:Mn}=En,An="undefined"!=typeof Image,In="undefined"!=typeof ImageBitmap,Rn=Boolean(Mn),On=!!xn||Rn,Cn=/^data:image\/svg\+xml/,Ln=/\.svg((\?|#).*)?$/;function Nn(t){return t&&(Cn.test(t)||Ln.test(t))}function Pn(t,e){if(Nn(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function kn(t,e,r){const s=function(t,e){if(Nn(e)){let e=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(t){throw new Error(t.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return Pn(t,e)}(t,r),i=self.URL||self.webkitURL,n="string"!=typeof s&&i.createObjectURL(s);try{return await async function(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise(((e,s)=>{try{r.onload=()=>e(r),r.onerror=e=>s(new Error(`Could not load image ${t}: ${e}`))}catch(t){s(t)}}))}(n||s,e)}finally{n&&i.revokeObjectURL(n)}}const Un={};let Dn=!0;function Bn(t){const e=Fn(t);return function(t){const e=Fn(t);return e.byteLength>=24&&2303741511===e.getUint32(0,!1)?{mimeType:"image/png",width:e.getUint32(16,!1),height:e.getUint32(20,!1)}:null}(e)||function(t){const e=Fn(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,!1)&&255===e.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:s}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let i=2;for(;i+9<e.byteLength;){const t=e.getUint16(i,!1);if(s.has(t))return{mimeType:"image/jpeg",height:e.getUint16(i+5,!1),width:e.getUint16(i+7,!1)};if(!r.has(t))return null;i+=2,i+=e.getUint16(i,!1)}return null}(e)||function(t){const e=Fn(t);return e.byteLength>=10&&1195984440===e.getUint32(0,!1)?{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}:null}(e)||function(t){const e=Fn(t);return e.byteLength>=14&&16973===e.getUint16(0,!1)&&e.getUint32(2,!0)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,!0),height:e.getUint32(22,!0)}:null}(e)}function Fn(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const jn={id:"image",module:"images",name:"Images",version:"3.0.10",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,r){const s=((e=e||{}).image||{}).type||"auto",{url:i}=r||{};let n;switch(function(t){switch(t){case"auto":case"data":return function(){if(In)return"imagebitmap";if(An)return"image";if(On)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return In||An||On;case"imagebitmap":return In;case"image":return An;case"data":return On;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}(t),t}}(s)){case"imagebitmap":n=await async function(t,e,r){let s;s=Nn(r)?await kn(t,e,r):Pn(t,r);const i=e&&e.imagebitmap;return await async function(t,e=null){if(!function(t){for(const e in t||Un)return!1;return!0}(e)&&Dn||(e=null),e)try{return await createImageBitmap(t,e)}catch(t){console.warn(t),Dn=!1}return await createImageBitmap(t)}(s,i)}(t,e,i);break;case"image":n=await kn(t,e,i);break;case"data":n=await function(t,e){const{mimeType:r}=Bn(t)||{},{_parseImageNode:s}=En;return vn(s),s(t,r,e)}(t,e);break;default:vn(!1)}return"data"===s&&(n=function(t){switch(function(t){const e=function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}(t);if(!e)throw new Error("Not an image");return e}(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}(n)),n},tests:[t=>Boolean(Bn(new DataView(t)))],options:{image:{type:"auto",decode:!0}}};function Vn(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function qn(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const zn=["SCALAR","VEC2","VEC3","VEC4"],Gn=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Hn=new Map(Gn),Wn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$n={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Kn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Qn(t){return zn[t-1]||zn[0]}function Xn(t){const e=Hn.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Yn(t,e){const r=Kn[t.componentType],s=Wn[t.type],i=$n[t.componentType],n=t.count*s,o=t.count*s*i;return Vn(o>=0&&o<=e.byteLength),{ArrayType:r,length:n,byteLength:o}}const Zn={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Jn{constructor(t){g(this,"gltf",void 0),g(this,"sourceBuffers",void 0),g(this,"byteLength",void 0),this.gltf=t||{json:{...Zn},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find((e=>e===t)),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find((e=>e===t))?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return r}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,r=this.gltf.buffers[e];Vn(r);const s=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,{ArrayType:s,length:i}=Yn(t,e);return new s(r,e.byteOffset+t.byteOffset,i)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(r,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){(t.extensions||{})[e]=r}removeObjectExtension(t,e){const r=t.extensions||{},s=r[e];return delete r[e],s}addExtension(t,e={}){return Vn(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return Vn(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((e=>e===t))||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((e=>e===t))||this.json.extensionsRequired.push(t)}removeExtension(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const s={mesh:e};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:s,mode:i=4}=t,n={primitives:[{attributes:this._addAttributes(e),mode:i}]};if(r){const t=this._addIndices(r);n.primitives[0].indices=t}return Number.isFinite(s)&&(n.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=Bn(t),s=e||(null==r?void 0:r.mimeType),i={bufferView:this.addBufferView(t),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(t){const e=t.byteLength;Vn(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=k(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:Qn(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const r=this.addBufferView(t);let s={min:e.min,max:e.max};s.min&&s.max||(s=this._getAccessorMinMax(t,e.size));const i={size:e.size,componentType:Xn(t),count:Math.round(t.length/e.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(i,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const r=this.byteLength,s=new ArrayBuffer(r),i=new Uint8Array(s);let n=0;for(const t of this.sourceBuffers||[])n=U(t,i,n);null!==(t=this.json)&&void 0!==t&&null!==(e=t.buffers)&&void 0!==e&&e[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=s,this.sourceBuffers=[s]}_removeStringFromArray(t,e){let r=!0;for(;r;){const s=t.indexOf(e);s>-1?t.splice(s,1):r=!1}}_addAttributes(t={}){const e={};for(const r in t){const s=t[r],i=this._getGltfAttributeName(r),n=this.addBinaryBuffer(s.value,s);e[i]=n}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const s=t.subarray(0,e);for(const t of s)r.min.push(t),r.max.push(t);for(let s=e;s<t.length;s+=e)for(let i=0;i<e;i++)r.min[0+i]=Math.min(r.min[0+i],t[s+i]),r.max[0+i]=Math.max(r.max[0+i],t[s+i]);return r}}function to(t){const{buffer:e,size:r,count:s}=function(t){let e=t,r=1,s=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=function(t,e,r=!1){return t?Array.isArray(t)?new e(t):!r||t instanceof e?t:new e(t):null}(e,Float32Array)),s=e.length/r),{buffer:e,size:r,count:s}}(t);return{value:e,size:r,byteOffset:0,count:s,type:Qn(r),componentType:Xn(e)}}async function eo(t,e,r,s){const i=t.getObjectExtension(e,"KHR_draco_mesh_compression");if(!i)return;const n=t.getTypedArrayForBufferView(i.bufferView),o=P(n.buffer,n.byteOffset),{parse:a}=s,c={...r};delete c["3d-tiles"];const h=await a(o,Ki,c,s),u=function(t){const e={};for(const r in t){const s=t[r];if("indices"!==r){const t=to(s);e[r]=t}}return e}(h.attributes);for(const[r,s]of Object.entries(u))if(r in e.attributes){const i=e.attributes[r],n=t.getAccessor(i);null!=n&&n.min&&null!=n&&n.max&&(s.min=n.min,s.max=n.max)}e.attributes=u,h.indices&&(e.indices=to(h.indices)),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(e)}function ro(t,e,r=4,s,i){var n;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=s.DracoWriter.encodeSync({attributes:t}),a=null==i||null===(n=i.parseSync)||void 0===n?void 0:n.call(i,{attributes:t}),c=s._addFauxAttributes(a.attributes);return{primitives:[{attributes:c,mode:r,extensions:{KHR_draco_mesh_compression:{bufferView:s.addBufferView(o),attributes:c}}}]}}function so(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((e=>{t.uniforms[e].value&&!(e in r)&&(r[e]=t.uniforms[e].value)})),Object.keys(r).forEach((t=>{"object"==typeof r[t]&&void 0!==r[t].index&&(r[t].texture=e.getTexture(r[t].index))})),r}const io={KHR_draco_mesh_compression:Object.freeze({__proto__:null,decode:async function(t,e,r){var s;if(null==e||null===(s=e.gltf)||void 0===s||!s.decompressMeshes)return;const i=new Jn(t),n=[];for(const t of function*(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}(i))i.getObjectExtension(t,"KHR_draco_mesh_compression")&&n.push(eo(i,t,e,r));await Promise.all(n),i.removeExtension("KHR_draco_mesh_compression")},encode:function(t,e={}){const r=new Jn(t);for(const t of r.json.meshes||[])ro(t),r.addRequiredExtension("KHR_draco_mesh_compression")}}),KHR_materials_unlit:Object.freeze({__proto__:null,decode:async function(t){const e=new Jn(t),{json:r}=e;e.removeExtension("KHR_materials_unlit");for(const t of r.materials||[])t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),e.removeObjectExtension(t,"KHR_materials_unlit")},encode:function(t){const e=new Jn(t),{json:r}=e;if(e.materials)for(const t of r.materials||[])t.unlit&&(delete t.unlit,e.addObjectExtension(t,"KHR_materials_unlit",{}),e.addExtension("KHR_materials_unlit"))}}),KHR_lights_punctual:Object.freeze({__proto__:null,decode:async function(t){const e=new Jn(t),{json:r}=e,s=e.getExtension("KHR_lights_punctual");s&&(e.json.lights=s.lights,e.removeExtension("KHR_lights_punctual"));for(const t of r.nodes||[]){const r=e.getObjectExtension(t,"KHR_lights_punctual");r&&(t.light=r.light),e.removeObjectExtension(t,"KHR_lights_punctual")}},encode:async function(t){const e=new Jn(t),{json:r}=e;if(r.lights){const t=e.addExtension("KHR_lights_punctual");Vn(!t.lights),t.lights=r.lights,delete r.lights}if(e.json.lights){for(const t of e.json.lights){const r=t.node;e.addObjectExtension(r,"KHR_lights_punctual",t)}delete e.json.lights}}}),KHR_techniques_webgl:Object.freeze({__proto__:null,decode:async function(t){const e=new Jn(t),{json:r}=e,s=e.getExtension("KHR_techniques_webgl");if(s){const t=function(t,e){const{programs:r=[],shaders:s=[],techniques:i=[]}=t,n=new TextDecoder;return s.forEach((t=>{if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=n.decode(e.getTypedArrayForBufferView(t.bufferView))})),r.forEach((t=>{t.fragmentShader=s[t.fragmentShader],t.vertexShader=s[t.vertexShader]})),i.forEach((t=>{t.program=r[t.program]})),i}(s,e);for(const s of r.materials||[]){const r=e.getObjectExtension(s,"KHR_techniques_webgl");r&&(s.technique=Object.assign({},r,t[r.technique]),s.technique.values=so(s.technique,e)),e.removeObjectExtension(s,"KHR_techniques_webgl")}e.removeExtension("KHR_techniques_webgl")}},encode:async function(t,e){}})},no={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},oo={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class ao{constructor(t){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}}normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn(`glTF: Unknown version ${r.asset.version}`)}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(t){const e=new Jn(t),{json:r}=e;for(const t of r.images||[]){const r=e.removeObjectExtension(t,"KHR_binary_glTF");r&&Object.assign(t,r)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension("KHR_binary_glTF")}(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in no)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(r&&!Array.isArray(r)){t[e]=[];for(const s in r){const i=r[s];i.id=i.id||s;const n=t[e].length;t[e].push(i),this.idToIndexMap[e][s]=n}}}_convertObjectIdsToArrayIndices(t){for(const e in no)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:t,indices:r,material:s}=e;for(const e in t)t[e]=this._convertIdToIndex(t[e],"accessor");r&&(e.indices=this._convertIdToIndex(r,"accessor")),s&&(e.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map((t=>this._convertIdToIndex(t,"node")))),t.meshes&&(t.meshes=t.meshes.map((t=>this._convertIdToIndex(t,"mesh"))))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map((t=>this._convertIdToIndex(t,"node"))))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const r of t[e])for(const t in r){const e=r[t],s=this._convertIdToIndex(e,t);r[t]=s}}_convertIdToIndex(t,e){const r=oo[e];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][t];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return s}return t}_updateObjects(t){for(const t of this.json.buffers)delete t.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=e.values&&e.values.tex,s=t.textures.findIndex((t=>t.id===r));-1!==s&&(e.pbrMetallicRoughness.baseColorTexture={index:s})}}}const co={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ho={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},uo={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},lo={magFilter:uo.TEXTURE_MAG_FILTER,minFilter:uo.TEXTURE_MIN_FILTER,wrapS:uo.TEXTURE_WRAP_S,wrapT:uo.TEXTURE_WRAP_T},fo={[uo.TEXTURE_MAG_FILTER]:uo.LINEAR,[uo.TEXTURE_MIN_FILTER]:uo.NEAREST_MIPMAP_LINEAR,[uo.TEXTURE_WRAP_S]:uo.REPEAT,[uo.TEXTURE_WRAP_]:uo.REPEAT};class po{postProcess(t,e={}){const{json:r,buffers:s=[],images:i=[],baseUri:n=""}=t;return Vn(r),this.baseUri=n,this.json=r,this.buffers=s,this.images=i,this._resolveTree(this.json,e),this.json}_resolveTree(t,e={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map(((t,e)=>this._resolveBufferView(t,e)))),t.images&&(t.images=t.images.map(((t,e)=>this._resolveImage(t,e)))),t.samplers&&(t.samplers=t.samplers.map(((t,e)=>this._resolveSampler(t,e)))),t.textures&&(t.textures=t.textures.map(((t,e)=>this._resolveTexture(t,e)))),t.accessors&&(t.accessors=t.accessors.map(((t,e)=>this._resolveAccessor(t,e)))),t.materials&&(t.materials=t.materials.map(((t,e)=>this._resolveMaterial(t,e)))),t.meshes&&(t.meshes=t.meshes.map(((t,e)=>this._resolveMesh(t,e)))),t.nodes&&(t.nodes=t.nodes.map(((t,e)=>this._resolveNode(t,e)))),t.skins&&(t.skins=t.skins.map(((t,e)=>this._resolveSkin(t,e)))),t.scenes&&(t.scenes=t.scenes.map(((t,e)=>this._resolveScene(t,e)))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if("object"==typeof e)return e;const r=this.json[t]&&this.json[t][e];return r||console.warn(`glTF file error: Could not find ${t}[${e}]`),r}_resolveScene(t,e){return t.id=t.id||`scene-${e}`,t.nodes=(t.nodes||[]).map((t=>this.getNode(t))),t}_resolveNode(t,e){return t.id=t.id||`node-${e}`,t.children&&(t.children=t.children.map((t=>this.getNode(t)))),void 0!==t.mesh?t.mesh=this.getMesh(t.mesh):void 0!==t.meshes&&t.meshes.length&&(t.mesh=t.meshes.reduce(((t,e)=>{const r=this.getMesh(e);return t.id=r.id,t.primitives=t.primitives.concat(r.primitives),t}),{primitives:[]})),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||`skin-${e}`,t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||`mesh-${e}`,t.primitives&&(t.primitives=t.primitives.map((t=>{const e=(t={...t}).attributes;t.attributes={};for(const r in e)t.attributes[r]=this.getAccessor(e[r]);return void 0!==t.indices&&(t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.material=this.getMaterial(t.material)),t}))),t}_resolveMaterial(t,e){if(t.id=t.id||`material-${e}`,t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const e=t.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){var r,s;if(t.id=t.id||`accessor-${e}`,void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(r=t.componentType,ho[r]),t.components=(s=t.type,co[s]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const e=t.bufferView.buffer,{ArrayType:r,byteLength:s}=Yn(t,t.bufferView),i=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+e.byteOffset,n=e.arrayBuffer.slice(i,i+s);t.value=new r(n)}return t}_resolveTexture(t,e){return t.id=t.id||`texture-${e}`,t.sampler="sampler"in t?this.getSampler(t.sampler):fo,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||`sampler-${e}`,t.parameters={};for(const e in t){const r=this._enumSamplerParameter(e);void 0!==r&&(t.parameters[r]=t[e])}return t}_enumSamplerParameter(t){return lo[t]}_resolveImage(t,e){t.id=t.id||`image-${e}`,void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));const r=this.images[e];return r&&(t.image=r),t}_resolveBufferView(t,e){t.id=t.id||`bufferView-${e}`;const r=t.buffer;t.buffer=this.buffers[r];const s=this.buffers[r].arrayBuffer;let i=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(i+=t.byteOffset),t.data=new Uint8Array(s,i,t.byteLength),t}_resolveCamera(t,e){return t.id=t.id||`camera-${e}`,t.perspective,t.orthographic,t}}const mo=1735152710,go=!0;function yo(t,e,r,s){const i=new Uint8Array(e.buffer,r,s),n=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(n),k(s,4)}function bo(t,e,r,s){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:s,arrayBuffer:e.buffer}),k(s,4)}async function wo(t,e,r,s,i){const{fetch:n,parse:o}=i;let a;if(e.uri){const t=qn(e.uri,s),r=await n(t);a=await r.arrayBuffer()}if(Number.isFinite(e.bufferView)){const r=function(t,e,r){const s=t.bufferViews[r];Vn(s);const i=e[s.buffer];Vn(i);const n=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,s.byteLength)}(t.json,t.buffers,e.bufferView);a=P(r.buffer,r.byteOffset,r.byteLength)}Vn(a,"glTF image has no data");const c=await o(a,jn,{},i);t.images[r]=c}const To={name:"glTF",id:"gltf",module:"gltf",version:"3.0.10",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,e={},s){(e={...To.options,...e}).gltf={...To.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await async function(t,e,s=0,i,n){var o,a,c,h;!function(t,e,s,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!function(t,e=0,r={}){const s=new DataView(t),{magic:i=mo}=r,n=s.getUint32(e,!1);return n===i||n===mo}(e,s,i)&&(e=(new TextDecoder).decode(e)),"string"==typeof e)t.json=function(t){try{return JSON.parse(t)}catch(e){throw new Error(`Failed to parse JSON from data starting with "${function(t,e=5){return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?L(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?L(t,0,e):""}(t)}"`)}}(e);else if(e instanceof ArrayBuffer){const n={};s=function(t,e,s=0,i={}){const n=new DataView(e),o=function(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}(n,s+0),a=n.getUint32(s+4,go),c=n.getUint32(s+8,go);switch(Object.assign(t,{header:{byteOffset:s,byteLength:c,hasBinChunk:!1},type:o,version:a,json:{},binChunks:[]}),s+=12,t.version){case 1:return function(t,e,s){r(t.header.byteLength>20);const i=e.getUint32(s+0,go),n=e.getUint32(s+4,go);return s+=8,r(0===n),yo(t,e,s,i),(s+=i)+bo(t,e,s,t.header.byteLength)}(t,n,s);case 2:return function(t,e,s,i){return r(t.header.byteLength>20),function(t,e,r,s){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,go),n=e.getUint32(r+4,go);switch(r+=8,n){case 1313821514:yo(t,e,r,i);break;case 5130562:bo(t,e,r,i);break;case 0:s.strict||yo(t,e,r,i);break;case 1:s.strict||bo(t,e,r,i)}r+=k(i,4)}}(t,e,s,{}),s+t.header.byteLength}(t,n,s);default:throw new Error(`Invalid GLB version ${t.version}. Only supports v1 and v2.`)}}(n,e,s,i.glb),Vn("glTF"===n.type,`Invalid GLB magic string ${n.type}`),t._glb=n,t.json=n.json}else Vn(!1,"GLTF: must be ArrayBuffer or string");const n=t.json.buffers||[];if(t.buffers=new Array(n.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}(t,e,s,i),function(t,e={}){(new ao).normalize(t,e)}(t,{normalize:null==i||null===(o=i.gltf)||void 0===o?void 0:o.normalize});const u=[];if(null!=i&&null!==(a=i.gltf)&&void 0!==a&&a.loadBuffers&&t.json.buffers&&await async function(t,e,r){for(let n=0;n<t.json.buffers.length;++n){const o=t.json.buffers[n];if(o.uri){var s,i;const{fetch:a}=r;Vn(a);const c=qn(o.uri,e),h=await(null==r||null===(s=r.fetch)||void 0===s?void 0:s.call(r,c)),u=await(null==h||null===(i=h.arrayBuffer)||void 0===i?void 0:i.call(h));t.buffers[n]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete o.uri}}}(t,i,n),null!=i&&null!==(c=i.gltf)&&void 0!==c&&c.loadImages){const e=async function(t,e,r){const s=t.json.images||[],i=[];for(let n=0;n<s.length;++n)i.push(wo(t,s[n],n,e,r));return await Promise.all(i)}(t,i,n);u.push(e)}const l=async function(t,e={},r){for(const i in io){var s;const n=(null==e||null===(s=e.gltf)||void 0===s?void 0:s.excludeExtensions)||{};if(!(i in n)||n[i]){const s=io[i];await s.decode(t,e,r)}}}(t,i,n);return u.push(l),await Promise.all(u),null!=i&&null!==(h=i.gltf)&&void 0!==h&&h.postProcess?function(t,e){return(new po).postProcess(t,e)}(t,i):t}({},t,i,e,s)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function vo(t,e,r,s){t.rotateYtoZ=!0;const i=t.byteOffset+t.byteLength-r;if(0===i)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=P(e,r,i),t.gltfByteOffset=0,t.gltfByteLength=i,r%4==0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),t.byteOffset+t.byteLength}async function _o(t,e,r,s){const i=r["3d-tiles"]||{};if(function(t,e,r){switch(e){case 0:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),r=(new TextDecoder).decode(e);t.gltfUrl=r.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case 1:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,e),i.loadGLTF){const{parse:e,fetch:i}=s;t.gltfUrl&&(t.gltfArrayBuffer=await i(t.gltfUrl,r),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,To,r,s),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}async function Eo(t,e=0,r,s,i={}){switch(i.byteOffset=e,i.type=function(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}(t,e),i.type){case"cmpt":return await async function(t,e,r,s,i,n){r=gn(t,e,r);const o=new DataView(e);for(t.tilesLength=o.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-r>12;){const o={};t.tiles.push(o),r=await n(e,r,s,i,o)}return r}(i,t,e,r,s,Eo);case"b3dm":return await async function(t,e,r,s,i){var n;r=function(t,e,r,s,i){r=vo(t,e,r=bn(t,e,r=yn(t,e,r=gn(t,e,r))),s);const n=new nn(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=n.getGlobalProperty("RTC_CENTER",Xi.FLOAT,3),r}(t,e,r,s),await _o(t,1,s,i);const o=null==t||null===(n=t.gltf)||void 0===n?void 0:n.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),r}(i,t,e,r,s);case"i3dm":return await async function(t,e,r,s,i){return r=function(t,e,r,s,i){if(r=gn(t,e,r),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=yn(t,e,r);const n=new DataView(e);if(t.gltfFormat=n.getUint32(r,!0),r=vo(t,e,r=bn(t,e,r+=4),s),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new nn(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",Xi.FLOAT,3),new mn(t.batchTableJson,t.batchTableBinary,a),function(t,e,r,s){const i=[new Array(s),t._batchTable][0],n=new Pe;new Pe,new Pe,new Pe;const o=new qe,a=new wr,c=new Pe,h={},u=new ur,l=[],d=[],f=new Pe,p=new Pe;for(let r=0;r<s;r++){let s;if(e.hasProperty("POSITION"))s=e.getProperty("POSITION",Xi.FLOAT,3,r,n);else if(e.hasProperty("POSITION_QUANTIZED")){s=e.getProperty("POSITION_QUANTIZED",Xi.UNSIGNED_SHORT,3,r,n);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Xi.FLOAT,3,f);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Xi.FLOAT,3,p);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)s[e]=s[e]/o*i[e]+t[e]}if(!s)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(n.copy(s),h.translation=n,t.normalUp=e.getProperty("NORMAL_UP",Xi.FLOAT,3,r,l),t.normalRight=e.getProperty("NORMAL_RIGHT",Xi.FLOAT,3,r,d),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Xi.UNSIGNED_SHORT,2,l),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Xi.UNSIGNED_SHORT,2,d),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(ds.WGS84.eastNorthUpToFixedFrame(n,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),h.rotation=a,c.set(1,1,1);const m=e.getProperty("SCALE",Xi.FLOAT,1,r);Number.isFinite(m)&&c.multiplyByScalar(m);const g=e.getProperty("SCALE_NON_UNIFORM",Xi.FLOAT,3,r,l);g&&c.scale(g),h.scale=c;let y=e.getProperty("BATCH_ID",Xi.UNSIGNED_SHORT,1,r);void 0===y&&(y=r);const b=(new ur).fromQuaternion(h.rotation);u.identity(),u.translate(h.translation),u.multiplyRight(b),u.scale(h.scale);const w=u.clone();i[r]={modelMatrix:w,batchId:y}}t.instances=i}(t,o,0,a),r}(t,e,r,s),await _o(t,t.gltfFormat,s,i),r}(i,t,e,r,s);case"pnts":return await async function(t,e,r,s,i){r=bn(t,e,r=yn(t,e,r=gn(t,e,r))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:n,batchTable:o}=function(t){const e=new nn(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",Xi.FLOAT,3);const s=function(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",Xi.UNSIGNED_SHORT,1),t.batchIds)){const s=e.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:n}=t;r=new mn(i,n,s)}return r}(t,e);return{featureTable:e,batchTable:s}}(t);return await async function(t,e,r,s,i){let n,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const e=h.byteOffset,r=h.byteLength;if(!o||!Number.isFinite(e)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");n=t.featureTableBinary.slice(e,e+r),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!n)return!0;const u={buffer:n,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(t,e,r,s){const{parse:i}=s,n={...r,draco:{...r.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];const o=await i(e.buffer,Ki,n),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,h=o.attributes.NORMAL&&o.attributes.NORMAL.value,u=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,l=a&&o.attributes.POSITION.value.quantization,d=h&&o.attributes.NORMAL.value.quantization;if(l){const e=o.POSITION.data.quantization,r=e.range;t.quantizedVolumeScale=new Pe(r,r,r),t.quantizedVolumeOffset=new Pe(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}d&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const t of Object.keys(e.batchTableProperties))o.attributes[t]&&o.attributes[t].value&&(f[t.toLowerCase()]=o.attributes[t].value);t.attributes={positions:a,colors:wn(t,c),normals:h,batchIds:u,...f}}(t,u,s,i)}(t,n,0,s,i),function(t,e,r){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",Xi.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const s=e.getPropertyArray("POSITION_QUANTIZED",Xi.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Xi.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Xi.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const r=new Pe,s=new Float32Array(3*t.pointCount);for(let i=0;i<t.pointCount;i++)r.set(e[3*i],e[3*i+1],e[3*i+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(s,3*i);return s}(t,e)):{type:Xi.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}(t,s,r)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,n,s),function(t,e,r){if(!t.attributes.colors){let s=null;e.hasProperty("RGBA")?(s=e.getPropertyArray("RGBA",Xi.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?s=e.getPropertyArray("RGB",Xi.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(s=e.getPropertyArray("RGB565",Xi.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=wn(t,s,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Xi.UNSIGNED_BYTE,4))}(t,n,o),function(t,e){if(!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",Xi.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",Xi.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array(3*t.pointsLength);for(let s=0;s<t.pointsLength;s++)sn(e[2*s],e[2*s+1],255,Tn),Tn.toArray(r,3*s);return{type:Xi.FLOAT,size:2,value:r}}return{type:Xi.FLOAT,size:2,value:e}}(t,r)}}(t,n),r}(i,t,e,r,s);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}function xo(t,e){if(t.content){const r=t.content.uri||t.content.url;t.contentUrl=`${e.basePath}/${r}`}return t.id=t.contentUrl,t.lodMetricType=ti,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=function(t){if(!t.contentUrl)return"empty";const e=t.contentUrl.split(".").pop();switch(e){case"pnts":return Ys;case"i3dm":case"b3dm":return Xs;default:return e}}(t),t.refine=function(t){switch(t){case"REPLACE":case"replace":return 2;case"ADD":case"add":return 1;default:return t}}(t.refine),t}const So={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:"3.0.10",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,r){const s=e["3d-tiles"]||{};let i;return i="auto"===s.isTileset?r.url&&-1!==r.url.indexOf(".json"):s.isTileset,t=i?await async function(t,e,r){const s=JSON.parse((new TextDecoder).decode(t));return s.loader=e.loader||So,s.url=r.url,s.basePath=function(t){return q(t.url)}(s),s.root=function(t){const e=t.basePath,r=xo(t.root,t),s=[];for(s.push(r);s.length>0;){const t=s.pop().children||[];for(const r of t)xo(r,{basePath:e}),s.push(r)}return r}(s),s.type=Js,s.lodMetricType=ti,s.lodMetricValue=s.root.lodMetricValue,s}(t,e,r):await async function(t,e,r){const s={content:{featureIds:null}};return await Eo(t,0,e,r,s.content),s.content}(t,e,r),t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},Mo={...So,id:"cesium-ion",name:"Cesium Ion",preload:async function(t,e={}){e=e["cesium-ion"]||{};const{accessToken:s}=e;let i=e.assetId;if(!Number.isFinite(i)){const e=t.match(/\/([0-9]+)\/tileset.json/);i=e&&e[1]}return async function(t,e){if(!e){const s=await async function(t){r(t);const e={Authorization:`Bearer ${t}`},s=await it("https://api.cesium.com/v1/assets",{fetch:{headers:e}});if(!s.ok)throw new Error(s.statusText);return await s.json()}(t);for(const t of s.items)"3DTILES"===t.type&&(e=t.id)}const s=await async function(t,e){r(t,e);const s={Authorization:`Bearer ${t}`},i=`https://api.cesium.com/v1/assets/${e}`;let n=await it(`${i}`,{fetch:{headers:s}});if(!n.ok)throw new Error(n.statusText);let o=await n.json();if(n=await it(`${i}/endpoint`,{fetch:{headers:s}}),!n.ok)throw new Error(n.statusText);const a=await n.json();return o={...o,...a},o}(t,e),{type:i,url:n}=s;return r("3DTILES"===i&&n),s.headers={Authorization:`Bearer ${s.accessToken}`},s}(s,i)},parse:async(t,e,r)=>((e={...e})["3d-tiles"]=e["cesium-ion"],e.loader=Mo,So.parse(t,e,r)),options:{"cesium-ion":{...So.options["3d-tiles"],accessToken:null}}};function Ao(e){const r=64,s=document.createElement("canvas");s.width=r,s.height=r;const i=s.getContext("2d");i.rect(0,0,r,r);const n=i.createLinearGradient(0,0,r,r);for(let t=0;t<e.length;t++){const r=e[t];n.addColorStop(r[0],"#"+r[1].getHexString())}i.fillStyle=n,i.fill();const o=new t.CanvasTexture(s);return o.needsUpdate=!0,o.minFilter=t.LinearFilter,o.wrapS=t.RepeatWrapping,o.wrapT=t.RepeatWrapping,o.repeat.set(2,2),o}function Io(e){e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.copy(e.matrixWorld).invert();const r=new t.Frustum;return r.setFromProjectionMatrix((new t.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),r}class Ro extends t.Loader{constructor(t){super(t),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new ko(t)})),this.register((function(t){return new Do(t)})),this.register((function(t){return new Bo(t)})),this.register((function(t){return new Uo(t)})),this.register((function(t){return new No(t)})),this.register((function(t){return new Fo(t)}))}load(e,r,s,i){var n,o=this;n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);var a=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},c=new t.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,(function(t){try{o.parse(t,n,(function(t){r(t),o.manager.itemEnd(e)}),a)}catch(t){a(t)}}),s,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(t){return this.ddsLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(e,r,s,i){var n,o={},a={};if("string"==typeof e)n=e;else if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===jo){try{o[Co.KHR_BINARY_GLTF]=new Vo(e)}catch(e){return void(i&&i(e))}n=o[Co.KHR_BINARY_GLTF].content}else n=t.LoaderUtils.decodeText(new Uint8Array(e));var c=e instanceof ArrayBuffer?JSON.parse(n):e;if(void 0===c.asset||c.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var h=new aa(c,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(var u=0;u<this.pluginCallbacks.length;u++){var l=this.pluginCallbacks[u](h);a[l.name]=l,o[l.name]=!0}if(c.extensionsUsed)for(u=0;u<c.extensionsUsed.length;++u){var d=c.extensionsUsed[u],f=c.extensionsRequired||[];switch(d){case Co.KHR_MATERIALS_UNLIT:o[d]=new Po;break;case Co.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[d]=new Ho;break;case Co.KHR_DRACO_MESH_COMPRESSION:o[d]=new qo(c,this.dracoLoader);break;case Co.MSFT_TEXTURE_DDS:o[d]=new Lo(this.ddsLoader);break;case Co.KHR_TEXTURE_TRANSFORM:o[d]=new zo;break;case Co.KHR_MESH_QUANTIZATION:o[d]=new Wo;break;default:f.indexOf(d)>=0&&void 0===a[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}h.setExtensions(o),h.setPlugins(a),h.parse(s,i)}}}function Oo(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}}var Co={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function Lo(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=Co.MSFT_TEXTURE_DDS,this.ddsLoader=t}function No(t){this.parser=t,this.name=Co.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function Po(){this.name=Co.KHR_MATERIALS_UNLIT}function ko(t){this.parser=t,this.name=Co.KHR_MATERIALS_CLEARCOAT}function Uo(t){this.parser=t,this.name=Co.KHR_MATERIALS_TRANSMISSION}function Do(t){this.parser=t,this.name=Co.KHR_TEXTURE_BASISU}function Bo(t){this.parser=t,this.name=Co.EXT_TEXTURE_WEBP,this.isSupported=null}function Fo(t){this.name=Co.EXT_MESHOPT_COMPRESSION,this.parser=t}No.prototype._markDefs=function(){for(var t=this.parser,e=this.parser.json.nodes||[],r=0,s=e.length;r<s;r++){var i=e[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}},No.prototype._loadLight=function(e){var r=this.parser,s="light:"+e,i=r.cache.get(s);if(i)return i;var n,o=r.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],c=new t.Color(16777215);void 0!==a.color&&c.fromArray(a.color);var h=void 0!==a.range?a.range:0;switch(a.type){case"directional":(n=new t.DirectionalLight(c)).target.position.set(0,0,-1),n.add(n.target);break;case"point":(n=new t.PointLight(c)).distance=h;break;case"spot":(n=new t.SpotLight(c)).distance=h,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,n.angle=a.spot.outerConeAngle,n.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,n.target.position.set(0,0,-1),n.add(n.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+a.type+'".')}return n.position.set(0,0,0),n.decay=2,void 0!==a.intensity&&(n.intensity=a.intensity),n.name=r.createUniqueName(a.name||"light_"+e),i=Promise.resolve(n),r.cache.add(s,i),i},No.prototype.createNodeAttachment=function(t){var e=this,r=this.parser,s=r.json.nodes[t]||t,i=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return r._getNodeRef(e.cache,i,t)}))},Po.prototype.getMaterialType=function(){return t.MeshBasicMaterial},Po.prototype.extendParams=function(e,r,s){var i=[];e.color=new t.Color(1,1,1),e.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&i.push(s.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(i)},ko.prototype.getMaterialType=function(e){var r=this.parser.json.materials[e]||e;return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null},ko.prototype.extendMaterialParams=function(e,r){var s=this.parser,i=s.json.materials[e]||e;if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var n=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(r.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&n.push(s.assignTexture(r,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(r.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&n.push(s.assignTexture(r,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(n.push(s.assignTexture(r,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var a=o.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new t.Vector2(a,a)}return Promise.all(n)},Uo.prototype.getMaterialType=function(e){var r=this.parser.json.materials[e]||e;return r.extensions&&r.extensions[this.name]?t.MeshPhysicalMaterial:null},Uo.prototype.extendMaterialParams=function(t,e){var r=this.parser,s=r.json.materials[t]||t;if(!s.extensions||!s.extensions[this.name])return Promise.resolve();var i=[],n=s.extensions[this.name];return void 0!==n.transmissionFactor&&(e.transmission=n.transmissionFactor),void 0!==n.transmissionTexture&&i.push(r.assignTexture(e,"transmissionMap",n.transmissionTexture)),Promise.all(i)},Do.prototype.loadTexture=function(t){var e=this.parser,r=e.json,s=r.textures[t]||t;if(!s.extensions||!s.extensions[this.name])return null;var i=s.extensions[this.name],n=r.images[i.source],o=e.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,n,o)},Bo.prototype.loadTexture=function(t){var e=this.name,r=this.parser,s=r.json,i=s.textures[t];if(!i.extensions||!i.extensions[e])return null;var n=i.extensions[e],o=s.images[n.source],a=o.uri?r.options.manager.getHandler(o.uri):r.textureLoader;return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(t,o,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)}))},Bo.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(t){var e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported},Fo.prototype.loadBufferView=function(t){var e=this.parser.json,r=e.bufferViews[t]||t;if(r.extensions&&r.extensions[this.name]){var s=r.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,n.ready]).then((function(t){var e=s.byteOffset||0,r=s.byteLength||0,i=s.count,o=s.byteStride,a=new ArrayBuffer(i*o),c=new Uint8Array(t[0],e,r);return n.decodeGltfBuffer(new Uint8Array(a),i,o,c,s.mode,s.filter),a}))}return null};var jo="glTF";function Vo(e){this.name=Co.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(e,0,12);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==jo)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var s=new DataView(e,12),i=0;i<s.byteLength;){var n=s.getUint32(i,!0);i+=4;var o=s.getUint32(i,!0);if(i+=4,1313821514===o){var a=new Uint8Array(e,12+i,n);this.content=t.LoaderUtils.decodeText(a)}else if(5130562===o){var c=12+i;this.body=e.slice(c,c+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function qo(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Co.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function zo(){this.name=Co.KHR_TEXTURE_TRANSFORM}function Go(e){t.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(var e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",n).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function Ho(){return{name:Co.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return Go},extendParams:function(e,r,s){var i=r.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;var n=[];if(Array.isArray(i.diffuseFactor)){var o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==i.diffuseTexture&&n.push(s.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var a=i.specularGlossinessTexture;n.push(s.assignTexture(e,"glossinessMap",a)),n.push(s.assignTexture(e,"specularMap",a))}return Promise.all(n)},createMaterial:function(e){var r=new Go(e);return r.fog=!0,r.color=e.color,r.map=void 0===e.map?null:e.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===e.aoMap?null:e.aoMap,r.aoMapIntensity=1,r.emissive=e.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,r.bumpMap=void 0===e.bumpMap?null:e.bumpMap,r.bumpScale=1,r.normalMap=void 0===e.normalMap?null:e.normalMap,r.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(r.normalScale=e.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===e.specularMap?null:e.specularMap,r.specular=e.specular,r.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,r.glossiness=e.glossiness,r.alphaMap=null,r.envMap=void 0===e.envMap?null:e.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r}}}function Wo(){this.name=Co.KHR_MESH_QUANTIZATION}function $o(e,r,s,i){t.Interpolant.call(this,e,r,s,i)}qo.prototype.decodePrimitive=function(t,e){var r=this.json,s=this.dracoLoader,i=t.extensions[this.name].bufferView,n=t.extensions[this.name].attributes,o={},a={},c={};for(var h in n){var u=Zo[h]||h.toLowerCase();o[u]=n[h]}for(h in t.attributes)if(u=Zo[h]||h.toLowerCase(),void 0!==n[h]){var l=r.accessors[t.attributes[h]],d=Ko[l.componentType];c[u]=d,a[u]=!0===l.normalized}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){s.decodeDracoFile(t,(function(t){for(var r in t.attributes){var s=t.attributes[r],i=a[r];void 0!==i&&(s.normalized=i)}e(t)}),o,c)}))}))},zo.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},Go.prototype=Object.create(t.MeshStandardMaterial.prototype),Go.prototype.constructor=Go,Go.prototype.copy=function(e){return t.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},$o.prototype=Object.create(t.Interpolant.prototype),$o.prototype.constructor=$o,$o.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,r=this.sampleValues,s=this.valueSize,i=t*s*3+s,n=0;n!==s;n++)e[n]=r[i+n];return e},$o.prototype.beforeStart_=$o.prototype.copySampleValue_,$o.prototype.afterEnd_=$o.prototype.copySampleValue_,$o.prototype.interpolate_=function(t,e,r,s){for(var i=this.resultBuffer,n=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,h=s-e,u=(r-e)/h,l=u*u,d=l*u,f=t*c,p=f-c,m=-2*d+3*l,g=d-l,y=1-m,b=g-l+u,w=0;w!==o;w++){var T=n[p+w+o],v=n[p+w+a]*h,_=n[f+w+o],E=n[f+w]*h;i[w]=y*T+b*v+m*_+g*E}return i};var Ko={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qo={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},Xo={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},Yo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Jo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ta={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete};function ea(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function ra(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),e.DefaultMaterial}function sa(t,e,r){for(var s in r.extensions)void 0===t[s]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=r.extensions[s])}function ia(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function na(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var r=0,s=e.weights.length;r<s;r++)t.morphTargetInfluences[r]=e.weights[r];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length)for(t.morphTargetDictionary={},r=0,s=i.length;r<s;r++)t.morphTargetDictionary[i[r]]=r;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function oa(t){for(var e="",r=Object.keys(t).sort(),s=0,i=r.length;s<i;s++)e+=r[s]+":"+t[r[s]]+";";return e}function aa(e,r){this.json=e||{},this.extensions={},this.plugins={},this.options=r||{},this.cache=new Oo,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new t.ImageBitmapLoader(this.options.manager):this.textureLoader=new t.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function ca(e,r,s){var i=r.attributes,n=[];function o(t,r){return s.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var a in i){var c=Zo[a]||a.toLowerCase();c in e.attributes&&null!=e.attributes[c]||n.push(o(i[a],c))}if(void 0!==r.indices&&!e.index){var h=s.getDependency("accessor",r.indices).then((function(t){e.setIndex(t)}));n.push(h)}return ia(e,r),function(e,r,s){var i=r.attributes,n=new t.Box3;if(void 0!==i.POSITION){var o=(f=s.json.accessors[i.POSITION]||i.POSITION).min,a=f.max;if(void 0!==o&&void 0!==a){n.set(new t.Vector3(o[0],o[1],o[2]),new t.Vector3(a[0],a[1],a[2]));var c=r.targets;if(void 0!==c){for(var h=new t.Vector3,u=new t.Vector3,l=0,d=c.length;l<d;l++){var f,p=c[l];void 0!==p.POSITION&&(o=(f=s.json.accessors[p.POSITION]).min,a=f.max,void 0!==o&&void 0!==a?(u.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),u.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),u.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),h.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}n.expandByVector(h)}e.boundingBox=n;var m=new t.Sphere;n.getCenter(m.center),m.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,r,s),Promise.all(n).then((function(){return void 0!==r.targets?function(t,e,r){for(var s=!1,i=!1,n=0,o=e.length;n<o&&(void 0!==(h=e[n]).POSITION&&(s=!0),void 0!==h.NORMAL&&(i=!0),!s||!i);n++);if(!s&&!i)return Promise.resolve(t);var a=[],c=[];for(n=0,o=e.length;n<o;n++){var h=e[n];if(s){var u=void 0!==h.POSITION?r.getDependency("accessor",h.POSITION):t.attributes.position;a.push(u)}i&&(u=void 0!==h.NORMAL?r.getDependency("accessor",h.NORMAL):t.attributes.normal,c.push(u))}return Promise.all([Promise.all(a),Promise.all(c)]).then((function(e){var r=e[0],n=e[1];return s&&(t.morphAttributes.position=r),i&&(t.morphAttributes.normal=n),t.morphTargetsRelative=!0,t}))}(e,r.targets,s):e}))}function ha(e,r){var s=e.getIndex();if(null===s){var i=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<n.count;o++)i.push(o);e.setIndex(i),s=e.getIndex()}var a=s.count-2,c=[];if(r===t.TriangleFanDrawMode)for(o=1;o<=a;o++)c.push(s.getX(0)),c.push(s.getX(o)),c.push(s.getX(o+1));else for(o=0;o<a;o++)o%2==0?(c.push(s.getX(o)),c.push(s.getX(o+1)),c.push(s.getX(o+2))):(c.push(s.getX(o+2)),c.push(s.getX(o+1)),c.push(s.getX(o)));c.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var h=e.clone();return h.setIndex(c),h}aa.prototype.setExtensions=function(t){this.extensions=t},aa.prototype.setPlugins=function(t){this.plugins=t},aa.prototype.parse=function(t,e){var r=this,s=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var n={scene:e[0][s.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:s.asset,parser:r,userData:{}};sa(i,n,s),ia(n,s),t(n)})).catch(e)},aa.prototype._markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[],s=0,i=e.length;s<i;s++)for(var n=e[s].joints,o=0,a=n.length;o<a;o++)t[n[o]].isBone=!0;for(var c=0,h=t.length;c<h;c++){var u=t[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(r[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},aa.prototype._addNodeRef=function(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)},aa.prototype._getNodeRef=function(t,e,r){if(t.refs[e]<=1)return r;var s=r.clone();return s.name+="_instance_"+t.uses[e]++,s},aa.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var r=0;r<e.length;r++){var s=t(e[r]);if(s)return s}},aa.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var r=[],s=0;s<e.length;s++){var i=t(e[s]);i&&r.push(i)}return r},aa.prototype.getDependency=function(t,e){var r=t+":"+e,s="number"==typeof e?this.cache.get(r):null;if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this.loadNode(e);break;case"mesh":s=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":s=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":s=this.loadSkin(e);break;case"animation":s=this.loadAnimation(e);break;case"camera":s=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,s)}return s},aa.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var r=this,s=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(s.map((function(e,s){return r.getDependency(t,s)}))),this.cache.add(t,e)}return e},aa.prototype.loadBuffer=function(t){var e=this.json.buffers[t]||t,r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t&&this.extensions[Co.KHR_BINARY_GLTF])return Promise.resolve(this.extensions[Co.KHR_BINARY_GLTF].body);var s=this.options;return new Promise((function(t,i){r.load(ea(e.uri,s.path),t,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},aa.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t]||t;return e.data?Promise.resolve(e.data):this.getDependency("buffer",e.buffer).then((function(t){var r=e.byteLength||0,s=e.byteOffset||0;return t.slice(s,s+r)}))},aa.prototype.loadAccessor=function(e){var r=this,s=this.json,i=this.json.accessors[e]||e;if((void 0===i.bufferView||null===i.bufferView)&&void 0===i.sparse&&!i.value)return Promise.resolve(null);var n=[];return void 0===i.bufferView||i.value?n.push(null):n.push(this.getDependency("bufferView",i.bufferView)),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then((function(e){var n,o,a=e[0],c=Yo[i.type],h=Ko[i.componentType],u=h.BYTES_PER_ELEMENT,l=u*c,d=i.byteOffset||0,f=void 0===i.bufferView||i.value?void 0:s.bufferViews[i.bufferView].byteStride,p=!0===i.normalized;if(f&&f!==l){var m=Math.floor(d/f),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,y=r.cache.get(g);y||(n=new h(a,m*f,i.count*f/u),y=new t.InterleavedBuffer(n,f/u),r.cache.add(g,y)),o=new t.InterleavedBufferAttribute(y,c,d%f/u,p)}else n=i.value?i.value:null===a?new h(i.count*c):new h(a,d,i.count*c),o=new t.BufferAttribute(n,c,p);if(void 0!==i.sparse){var b=Yo.SCALAR,w=Ko[i.sparse.indices.componentType],T=i.sparse.indices.byteOffset||0,v=i.sparse.values.byteOffset||0,_=new w(e[1],T,i.sparse.count*b),E=new h(e[2],v,i.sparse.count*c);null!==a&&(o=new t.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var x=0,S=_.length;x<S;x++){var M=_[x];if(o.setX(M,E[x*c]),c>=2&&o.setY(M,E[x*c+1]),c>=3&&o.setZ(M,E[x*c+2]),c>=4&&o.setW(M,E[x*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},aa.prototype.loadTexture=function(t){var e,r,s=this.json,i=this.options,n=s.textures[t]||t,o=n.extensions||{};return(e=o[Co.MSFT_TEXTURE_DDS]?s.images[o[Co.MSFT_TEXTURE_DDS].source]:s.images[n.source]||n.source).uri&&(r=i.manager.getHandler(e.uri)),r||(r=o[Co.MSFT_TEXTURE_DDS]?this.extensions[Co.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(t,e,r)},aa.prototype.loadTextureImage=function(e,r,s){var i,n=this,o=this.json,a=this.options,c=o.textures[e]||e,h=self.URL||self.webkitURL,u=r.uri,l=!1,d=!0;return"image/jpeg"===r.mimeType&&(d=!1),void 0!==r.bufferView&&(u=n.getDependency("bufferView",r.bufferView).then((function(t){if("image/png"===r.mimeType){var e=new DataView(t,25,1).getUint8(0,!1);d=6===e||4===e||3===e}return new Blob([t],{type:r.mimeType})}))),i=s.isImageBitmapLoader?Promise.resolve(u).then((function(t){return createImageBitmap(t,{premultiplyAlpha:"none"})})).then((function(e){return new t.CanvasTexture(e)})):Promise.resolve(u).then((function(t){return l=!0,u=h.createObjectURL(t)})).then((function(t){return new Promise((function(e,r){var i=e;s.load(ea(t,a.path),i,void 0,r)}))})),Promise.resolve(i).then((function(r){!0===l&&h.revokeObjectURL(u),r.flipY=!1,c.name&&(r.name=c.name),d||(r.format=t.RGBFormat);var s=(o.samplers||{})[c.sampler]||{};return r.magFilter=Qo[s.magFilter]||t.LinearFilter,r.minFilter=Qo[s.minFilter]||t.LinearMipmapLinearFilter,r.wrapS=Xo[s.wrapS]||t.RepeatWrapping,r.wrapT=Xo[s.wrapT]||t.RepeatWrapping,n.associations.set(r,{type:"textures",index:e}),r}))},aa.prototype.assignTexture=function(t,e,r){var s=this;return this.getDependency("texture",r.index).then((function(i){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===e&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),s.extensions[Co.KHR_TEXTURE_TRANSFORM]){var n=void 0!==r.extensions?r.extensions[Co.KHR_TEXTURE_TRANSFORM]:void 0;if(n){var o=s.associations.get(i);i=s.extensions[Co.KHR_TEXTURE_TRANSFORM].extendTexture(i,n),s.associations.set(i,o)}}t[e]=i}))},aa.prototype.assignFinalMaterial=function(e){var r=e.geometry,s=e.material,i=void 0!==r.attributes.tangent,n=void 0!==r.attributes.color,o=void 0===r.attributes.normal,a=!0===e.isSkinnedMesh,c=Object.keys(r.morphAttributes).length>0,h=c&&void 0!==r.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+s.uuid,l=this.cache.get(u);l||(l=new t.PointsMaterial,t.Material.prototype.copy.call(l,s),l.color.copy(s.color),l.map=s.map,l.sizeAttenuation=!1,this.cache.add(u,l)),s=l}else if(e.isLine){u="LineBasicMaterial:"+s.uuid;var d=this.cache.get(u);d||(d=new t.LineBasicMaterial,t.Material.prototype.copy.call(d,s),d.color.copy(s.color),this.cache.add(u,d)),s=d}if(i||n||o||a||c){u="ClonedMaterial:"+s.uuid+":",s.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),a&&(u+="skinning:"),i&&(u+="vertex-tangents:"),n&&(u+="vertex-colors:"),o&&(u+="flat-shading:"),c&&(u+="morph-targets:"),h&&(u+="morph-normals:");var f=this.cache.get(u);f||(f=s.clone(),a&&(f.skinning=!0),i&&(f.vertexTangents=!0),n&&(f.vertexColors=!0),o&&(f.flatShading=!0),c&&(f.morphTargets=!0),h&&(f.morphNormals=!0),this.cache.add(u,f),this.associations.set(f,this.associations.get(s))),s=f}s.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",r.attributes.uv),s.normalScale&&!i&&(s.normalScale.y=-s.normalScale.y),s.clearcoatNormalScale&&!i&&(s.clearcoatNormalScale.y=-s.clearcoatNormalScale.y),e.material=s},aa.prototype.getMaterialType=function(){return t.MeshStandardMaterial},aa.prototype.loadMaterial=function(e){var r,s=this,i=this.json,n=this.extensions,o=i.materials[e]||e,a={},c=o.extensions||{},h=[];if(c[Co.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=n[Co.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=u.getMaterialType(),h.push(u.extendParams(a,o,s))}else if(c[Co.KHR_MATERIALS_UNLIT]){var l=n[Co.KHR_MATERIALS_UNLIT];r=l.getMaterialType(),h.push(l.extendParams(a,o,s))}else{var d=o.pbrMetallicRoughness||{};if(a.color=new t.Color(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var f=d.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}void 0!==d.baseColorTexture&&h.push(s.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(h.push(s.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),h.push(s.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),h.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===o.doubleSided&&(a.side=t.DoubleSide);var p=o.alphaMode||"OPAQUE";return"BLEND"===p?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===p&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&r!==t.MeshBasicMaterial&&(h.push(s.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new t.Vector2(1,1),void 0!==o.normalTexture.scale&&a.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&r!==t.MeshBasicMaterial&&(h.push(s.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&r!==t.MeshBasicMaterial&&(a.emissive=(new t.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&r!==t.MeshBasicMaterial&&h.push(s.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(h).then((function(){var i;return i=r===Go?n[Co.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new r(a),o.name&&(i.name=o.name),i.map&&(i.map.encoding=t.sRGBEncoding),i.emissiveMap&&(i.emissiveMap.encoding=t.sRGBEncoding),ia(i,o),s.associations.set(i,{type:"materials",index:e}),o.extensions&&sa(n,i,o),i}))},aa.prototype.createUniqueName=function(e){for(var r=t.PropertyBinding.sanitizeNodeName(e||""),s=1;this.nodeNamesUsed[r];++s)r=e+"_"+s;return this.nodeNamesUsed[r]=!0,r},aa.prototype.loadGeometries=function(e){var r=this,s=this.extensions,i=this.primitiveCache;function n(t){return s[Co.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,r).then((function(e){return ca(e,t,r)}))}for(var o,a,c=[],h=0,u=e.length;h<u;h++){var l,d=e[h],f=null,p=null;"number"==typeof d.indices&&(p=i[f=(a=(o=d).extensions&&o.extensions[Co.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+oa(a.attributes):o.indices+":"+oa(o.attributes)+":"+o.mode]),p?c.push(p.promise):(l=d.extensions&&d.extensions[Co.KHR_DRACO_MESH_COMPRESSION]&&"number"==typeof d.indices?n(d):ca(new t.BufferGeometry,d,r),f&&(i[f]={primitive:d,promise:l}),c.push(l))}return Promise.all(c)},aa.prototype.loadMesh=function(e){for(var r=this,s=this.json.meshes[e]||e,i=s.primitives,n=[],o=0,a=i.length;o<a;o++){var c=void 0===i[o].material?ra(this.cache):this.getDependency("material",i[o].material);n.push(c)}return n.push(r.loadGeometries(i)),Promise.all(n).then((function(n){for(var o=n.slice(0,n.length-1),a=n[n.length-1],c=[],h=0,u=a.length;h<u;h++){var l,d=a[h],f=i[h],p=o[h];if(4===f.mode||5===f.mode||6===f.mode||void 0===f.mode)!0!==(l=!0===s.isSkinnedMesh?new t.SkinnedMesh(d,p):new t.Mesh(d,p)).isSkinnedMesh||l.geometry.attributes.skinWeight.normalized||l.normalizeSkinWeights(),5===f.mode?l.geometry=ha(l.geometry,t.TriangleStripDrawMode):6===f.mode&&(l.geometry=ha(l.geometry,t.TriangleFanDrawMode));else if(1===f.mode)l=new t.LineSegments(d,p);else if(3===f.mode)l=new t.Line(d,p);else if(2===f.mode)l=new t.LineLoop(d,p);else{if(0!==f.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);l=new t.Points(d,p)}Object.keys(l.geometry.morphAttributes).length>0&&na(l,s),l.name=r.createUniqueName(s.name||"mesh_"+e),ia(l,s),r.assignFinalMaterial(l),c.push(l)}if(1===c.length)return c[0];var m=new t.Group;for(h=0,u=c.length;h<u;h++)m.add(c[h]);return m}))},aa.prototype.loadCamera=function(e){var r,s=this.json.cameras[e],i=s[s.type];if(i)return"perspective"===s.type?r=new t.PerspectiveCamera(t.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===s.type&&(r=new t.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(r.name=this.createUniqueName(s.name)),ia(r,s),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")},aa.prototype.loadSkin=function(t){var e=this.json.skins[t],r={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return r.inverseBindMatrices=t,r}))},aa.prototype.loadAnimation=function(e){for(var r=this.json.animations[e],s=[],i=[],n=[],o=[],a=[],c=0,h=r.channels.length;c<h;c++){var u=r.channels[c],l=r.samplers[u.sampler],d=u.target,f=void 0!==d.node?d.node:d.id,p=void 0!==r.parameters?r.parameters[l.input]:l.input,m=void 0!==r.parameters?r.parameters[l.output]:l.output;s.push(this.getDependency("node",f)),i.push(this.getDependency("accessor",p)),n.push(this.getDependency("accessor",m)),o.push(l),a.push(d)}return Promise.all([Promise.all(s),Promise.all(i),Promise.all(n),Promise.all(o),Promise.all(a)]).then((function(s){for(var i=s[0],n=s[1],o=s[2],a=s[3],c=s[4],h=[],u=0,l=i.length;u<l;u++){var d=i[u],f=n[u],p=o[u],m=a[u],g=c[u];if(void 0!==d){var y;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,Jo[g.path]){case Jo.weights:y=t.NumberKeyframeTrack;break;case Jo.rotation:y=t.QuaternionKeyframeTrack;break;default:y=t.VectorKeyframeTrack}var b=d.name?d.name:d.uuid,w=void 0!==m.interpolation?ta[m.interpolation]:t.InterpolateLinear,T=[];Jo[g.path]===Jo.weights?d.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&T.push(t.name?t.name:t.uuid)})):T.push(b);var v=p.array;if(p.normalized){var _;if(v.constructor===Int8Array)_=1/127;else if(v.constructor===Uint8Array)_=1/255;else if(v.constructor==Int16Array)_=1/32767;else{if(v.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");_=1/65535}for(var E=new Float32Array(v.length),x=0,S=v.length;x<S;x++)E[x]=v[x]*_;v=E}for(x=0,S=T.length;x<S;x++){var M=new y(T[x]+"."+Jo[g.path],f.array,v,w);"CUBICSPLINE"===m.interpolation&&(M.createInterpolant=function(t){return new $o(this.times,this.values,this.getValueSize()/3,t)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(M)}}}var A=r.name?r.name:"animation_"+e;return new t.AnimationClip(A,void 0,h)}))},aa.prototype.loadNode=function(e){var r,s=this.json,i=this.extensions,n=this,o=s.nodes[e]||e,a=o.name?n.createUniqueName(o.name):"";return(r=[],void 0!==o.mesh&&r.push(n.getDependency("mesh",o.mesh).then((function(t){var e=n._getNodeRef(n.meshCache,o.mesh,t);return void 0!==o.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,r=o.weights.length;e<r;e++)t.morphTargetInfluences[e]=o.weights[e]})),e}))),void 0!==o.camera&&r.push(n.getDependency("camera",o.camera).then((function(t){return n._getNodeRef(n.cameraCache,o.camera,t)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(t){r.push(t)})),Promise.all(r)).then((function(r){var s;if((s=!0===o.isBone?new t.Bone:r.length>1?new t.Group:1===r.length?r[0]:new t.Object3D)!==r[0])for(var c=0,h=r.length;c<h;c++)s.add(r[c]);if(o.name&&(s.userData.name=o.name,s.name=a),ia(s,o),o.extensions&&sa(i,s,o),void 0!==o.matrix){var u=new t.Matrix4;u.fromArray(o.matrix),s.applyMatrix4(u)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return n.associations.set(s,{type:"nodes",index:e}),s}))},aa.prototype.loadScene=function(){function e(r,s,i,n){var o=i.nodes[r]||r;return n.getDependency("node",r).then((function(e){return void 0===o.skin?e:n.getDependency("skin",o.skin).then((function(t){for(var e=[],s=0,i=(r=t).joints.length;s<i;s++)e.push(n.getDependency("node",r.joints[s]));return Promise.all(e)})).then((function(s){return e.traverse((function(e){if(e.isMesh){for(var i=[],n=[],o=0,a=s.length;o<a;o++){var c=s[o];if(c){i.push(c);var h=new t.Matrix4;void 0!==r.inverseBindMatrices&&h.fromArray(r.inverseBindMatrices.array,16*o),n.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[o])}e.bind(new t.Skeleton(i,n),e.matrixWorld)}})),e}));var r})).then((function(t){s.add(t);var r=[];if(o.children)for(var a=o.children,c=0,h=a.length;c<h;c++){var u=a[c];r.push(e(u,t,i,n))}return Promise.all(r)}))}return function(r){var s=this.json,i=this.extensions,n=this.json.scenes[r],o=new t.Group;n.name&&(o.name=this.createUniqueName(n.name)),ia(o,n),n.extensions&&sa(i,o,n);for(var a=n.nodes||[],c=[],h=0,u=a.length;h<u;h++)c.push(e(a[h],o,s,this));return Promise.all(c).then((function(){return o}))}}();const ua={SPECTRAL:[[0,new t.Color(.3686,.3098,.6353)],[.1,new t.Color(.1961,.5333,.7412)],[.2,new t.Color(.4,.7608,.6471)],[.3,new t.Color(.6706,.8667,.6431)],[.4,new t.Color(.902,.9608,.5961)],[.5,new t.Color(1,1,.749)],[.6,new t.Color(.9961,.8784,.5451)],[.7,new t.Color(.9922,.6824,.3804)],[.8,new t.Color(.9569,.4275,.2627)],[.9,new t.Color(.8353,.2431,.3098)],[1,new t.Color(.6196,.0039,.2588)]],PLASMA:[[0,new t.Color(.241,.015,.61)],[.1,new t.Color(.387,.001,.654)],[.2,new t.Color(.524,.025,.653)],[.3,new t.Color(.651,.125,.596)],[.4,new t.Color(.752,.227,.513)],[.5,new t.Color(.837,.329,.431)],[.6,new t.Color(.907,.435,.353)],[.7,new t.Color(.963,.554,.272)],[.8,new t.Color(.992,.681,.195)],[.9,new t.Color(.987,.822,.144)],[1,new t.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new t.Color(.1647,.2824,.3451)],[.1,new t.Color(.1338,.3555,.4227)],[.2,new t.Color(.061,.4319,.4864)],[.3,new t.Color(0,.5099,.5319)],[.4,new t.Color(0,.5881,.5569)],[.5,new t.Color(.137,.665,.5614)],[.6,new t.Color(.2906,.7395,.5477)],[.7,new t.Color(.4453,.8099,.5201)],[.8,new t.Color(.6102,.8748,.485)],[.9,new t.Color(.7883,.9323,.4514)],[1,new t.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new t.Color(.267,.005,.329)],[.1,new t.Color(.283,.141,.458)],[.2,new t.Color(.254,.265,.53)],[.3,new t.Color(.207,.372,.553)],[.4,new t.Color(.164,.471,.558)],[.5,new t.Color(.128,.567,.551)],[.6,new t.Color(.135,.659,.518)],[.7,new t.Color(.267,.749,.441)],[.8,new t.Color(.478,.821,.318)],[.9,new t.Color(.741,.873,.15)],[1,new t.Color(.993,.906,.144)]],INFERNO:[[0,new t.Color(.077,.042,.206)],[.1,new t.Color(.225,.036,.388)],[.2,new t.Color(.373,.074,.432)],[.3,new t.Color(.522,.128,.42)],[.4,new t.Color(.665,.182,.37)],[.5,new t.Color(.797,.255,.287)],[.6,new t.Color(.902,.364,.184)],[.7,new t.Color(.969,.516,.063)],[.8,new t.Color(.988,.683,.072)],[.9,new t.Color(.961,.859,.298)],[1,new t.Color(.988,.998,.645)]],GRAYSCALE:[[0,new t.Color(0,0,0)],[1,new t.Color(1,1,1)]],TURBO:[[0,new t.Color(.18995,.07176,.23217)],[.07,new t.Color(.25107,.25237,.63374)],[.13,new t.Color(.27628,.42118,.89123)],[.2,new t.Color(.25862,.57958,.99876)],[.27,new t.Color(.15844,.73551,.92305)],[.33,new t.Color(.09267,.86554,.7623)],[.4,new t.Color(.19659,.94901,.59466)],[.47,new t.Color(.42778,.99419,.38575)],[.53,new t.Color(.64362,.98999,.23356)],[.6,new t.Color(.80473,.92452,.20459)],[.67,new t.Color(.93301,.81236,.22667)],[.73,new t.Color(.99314,.67408,.20348)],[.8,new t.Color(.9836,.49291,.12849)],[.87,new t.Color(.92105,.31489,.05475)],[.93,new t.Color(.81608,.18462,.01809)],[1,new t.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new t.Color(.278,0,.714)],[1/6,new t.Color(0,0,1)],[2/6,new t.Color(0,1,1)],[.5,new t.Color(0,1,0)],[4/6,new t.Color(1,1,0)],[5/6,new t.Color(1,.64,0)],[1,new t.Color(1,0,0)]],CONTOUR:[[0,new t.Color(0,0,0)],[.03,new t.Color(0,0,0)],[.04,new t.Color(1,1,1)],[1,new t.Color(1,1,1)]]};var la,da;!function(t){t[t.Intensity=1]="Intensity",t[t.Classification=2]="Classification",t[t.Elevation=3]="Elevation",t[t.RGB=4]="RGB",t[t.White=5]="White"}(la||(la={})),function(t){t[t.FlatTexture=1]="FlatTexture",t[t.ShadedTexture=2]="ShadedTexture",t[t.ShadedNoTexture=3]="ShadedNoTexture"}(da||(da={}));const fa="undefined"!=typeof document?Ao(ua.RAINBOW):null,pa="undefined"!=typeof document?Ao(ua.GRAYSCALE):null,ma={initialTransform:new t.Matrix4,throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,maximumMemoryUsage:32,viewDistanceScale:1,skipLevelOfDetail:!1,updateTransforms:!0,shading:da.FlatTexture,pointCloudColoring:la.White,worker:!0,wireframe:!1,debug:!1,basisTranscoderPath:null,dracoDecoderPath:null,material:null,computeNormals:!1,shaderCallback:null,loadersGlGltf:!0};function ga(t){t.traverse((t=>{var e,r;if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)null===(e=t.material.uniforms.map.value)||void 0===e||e.dispose(),t.material.dispose();else for(const e of t.material)null===(r=e.uniforms.map.value)||void 0===r||r.dispose(),e.dispose()}));for(let e=t.children.length-1;e>=0;e--){const r=t.children[e];t.remove(r)}}if(s(384),"undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("loader-3dtiles",{schema:{url:{type:"string"},cameraEl:{type:"selector"},maximumSSE:{type:"int",default:16},maximumMem:{type:"int",default:32},distanceScale:{type:"number",default:1},wireframe:{type:"boolean",default:!1},showStats:{type:"boolean",default:!1},cesiumIONToken:{type:"string"}},init:async function(){if(this.camera=this.data.cameraEl?.object3D.children[0]??document.querySelector("a-scene").camera,!this.camera)throw new Error("3D Tiles: Please add an active camera or specify the target camera via the cameraEl property");const{model:t,runtime:e}=await this._initTileset();this.runtime=e,this.el.setObject3D("tileset",t),this.originalCamera=this.camera,this.el.sceneEl.addEventListener("camera-set-active",(t=>{this.camera=t.detail.cameraEl.object3D.children[0]??this.originalCamera})),this.el.sceneEl.addEventListener("enter-vr",(t=>{this.originalCamera=this.camera,this.camera=this.el.sceneEl.renderer.xr.getCamera(this.camera),this.el.sceneEl.renderer.xr.getSession().requestAnimationFrame(((t,e)=>{const r=this.el.sceneEl.renderer.xr.getReferenceSpace(),s=e.getViewerPose(r);if(s){const t=s.views[0].projectionMatrix[5];this.camera.fov=2*Math.atan2(1,t)*180/Math.PI}}))})),this.el.sceneEl.addEventListener("exit-vr",(t=>{this.camera=this.originalCamera})),this.data.showStats&&(this.stats=this._initStats()),THREE.Cache.enabled&&(console.warn("3D Tiles loader cannot work with THREE.Cache, disabling."),THREE.Cache.enabled=!1)},update:async function(t){if(t.url!==this.data.url){this.runtime&&this.runtime.dispose();const{model:t,runtime:e}=await this._initTileset();this.el.setObject3D("tileset",t),this.runtime=e}else this.runtime&&(this.runtime.setWireframe(this.data.wireframe),this.runtime.setViewDistanceScale(this.data.distanceScale));this.data.showStats&&!this.stats&&(this.stats=this._initStats()),!this.data.showStats&&this.stats&&(this.el.sceneEl.removeChild(this.stats),this.stats=null)},tick:function(e,r){if(this.runtime&&(this.runtime.update(r,this.el.sceneEl.renderer,this.camera),this.stats)){const e=new t.Vector3;this.camera.getWorldPosition(e);const r=this.runtime.getStats();this.stats.setAttribute("textarea","text",Object.values(r.stats).map((t=>`${t.name}: ${t.count}`)).join("\n"));const s=new t.Vector3;s.copy(e),s.z-=2,this.stats.setAttribute("position",s)}},remove:function(){this.runtime&&this.runtime.dispose()},_initTileset:async function(){return class{static load(r){return e(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},ma),r.options),{url:i}=r,n=s.updateInterval,o={};if(s.cesiumIONToken){o["cesium-ion"]={accessToken:s.cesiumIONToken};const t=yield Mo.preload(i,o);o.fetch={headers:t.headers}}const a=yield Qt(i,So,Object.assign({},o)),c={},h={},u=[],l=new t.Group,d=new t.Group;s.debug||(d.visible=!1);let f=new t.Matrix4;const p=a.root.transform?(new t.Matrix4).fromArray(a.root.transform):new t.Matrix4;if(1==a.root.children.length&&a.root.children[0].transform){const e=(new t.Matrix4).fromArray(a.root.children[0].transform);p.multiply(e)}f.copy(p).invert();const m=f.clone();f.premultiply(s.initialTransform);let g=new ur(f.toArray());const y={pointSize:{type:"f",value:1},gradient:{type:"t",value:fa},grayscale:{type:"t",value:pa},rootCenter:{type:"vec3",value:new t.Vector3},rootNormal:{type:"vec3",value:new t.Vector3},coloring:{type:"i",value:s.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new t.Vector2(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1}};let b=null,w=null;const T=s.loadersGlGltf?new Ro:new t.GLTFLoader;if(s.basisTranscoderPath){const e=new t.KTX2Loader;e.detectSupport(r.renderer),e.setTranscoderPath(s.basisTranscoderPath+"/"),e.setWorkerLimit(1),T.setKTX2Loader(e)}if(!s.loadersGlGltf&&s.dracoDecoderPath){const e=new t.DRACOLoader;e.setDecoderPath(s.dracoDecoderPath+"/"),e.setWorkerLimit(s.maxConcurrency),T.setDRACOLoader(e)}const v=new t.ShaderMaterial({uniforms:{},vertexShader:"\n  varying vec2 vUv;\n  void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",fragmentShader:"\n  uniform sampler2D map;\n  varying vec2 vUv;\n\n  void main() {\n    vec4 realColor = texture2D(map, vUv);\n    gl_FragColor = realColor;\n  }\n"}),_={modelMatrix:g,maximumMemoryUsage:s.maximumMemoryUsage,maximumScreenSpaceError:s.maximumScreenSpaceError,viewDistanceScale:s.viewDistanceScale,skipLevelOfDetail:s.skipLevelOfDetail,updateTransforms:s.updateTransforms,throttleRequests:s.throttleRequests,maxRequests:s.maxRequests,contentLoader:r=>e(this,void 0,void 0,(function*(){let i=null;switch(r.type){case Ys:i=function(e,r){const s={rtc_center:e.content.rtcCenter,points:e.content.attributes.positions,intensities:e.content.attributes.intensity,classifications:e.content.attributes.classification,rgb:null,rgba:null},{colors:i}=e.content.attributes;i&&3===i.size&&(s.rgb=i.value),i&&4===i.size&&(s.rgba=i.value);const n=new t.BufferGeometry;n.setAttribute("position",new t.Float32BufferAttribute(s.points,3));const o=new t.ShaderMaterial({uniforms:r,vertexShader:"\n  varying vec3 vColor;\n  uniform sampler2D gradient;\n  uniform sampler2D grayscale;\n  attribute float intensity;\n  attribute float classification;\n  uniform vec3 rootCenter;\n  uniform vec3 rootNormal;\n  uniform vec2 elevationRange;\n  uniform int coloring;\n  uniform bool hideGround;\n  uniform float maxIntensity;\n  uniform float intensityContrast;\n\n  #ifdef USE_COLOR\n  vec3 getRGB() {\n      vec3 rgb = color;\n      return rgb;\n  }\n  #endif\n\n  vec3 getElevation(){\n    vec4 world = modelMatrix * vec4( position, 1.0 );\n    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));\n    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);\n    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\n    return cElevation;\n  }\n\n  vec3 getIntensity(){\n    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs\n    float intmod = pow(intensity, intensityContrast);\n    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;\n    return cIntensity;\n  }\n\n  vec3 getClassification(){\n    float classNormalized = classification / 255.0;\n    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;\n    return cClassification;\n  }\n\n  vec3 getColor(){\n      vec3 color;\n      if (hideGround && classification == 2.0) {\n         return vec3(0.0, 0.0, 0.0);               \n      }\n\n      if (coloring == 1) {\n        color = getIntensity();\n      }\n      else if (coloring == 2) {\n        color = getClassification();\n      } else if (coloring == 3) {\n        color = getElevation();\n      } \n      #ifdef USE_COLOR\n      else if (coloring == 4) {\n        color = getRGB();\n      }\n      #endif\n      else {\n        color = vec3(1.0, 1.0, 1.0);\n      }\n      return color;\n  }\n\n  void main() {\n      vColor = getColor();\n\n      gl_PointSize = 1.0;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",fragmentShader:"\n  varying vec3 vColor;\n  void main() {\n    if (vColor == vec3(0.0, 0.0, 0.0)) {\n      discard;\n    } else {\n      gl_FragColor = vec4( vColor, 1.0 );\n    }\n  }\n",transparent:!0});s.rgba?(n.setAttribute("color",new t.Float32BufferAttribute(s.rgba,4)),o.vertexColors=!0):s.rgb&&(n.setAttribute("color",new t.Uint8BufferAttribute(s.rgb,3,!0)),o.vertexColors=!0),s.intensities&&n.setAttribute("intensity",new t.Uint8BufferAttribute(s.intensities,1,!0)),s.classifications&&n.setAttribute("classification",new t.Uint8BufferAttribute(s.classifications,1,!1));const a=new t.Points(n,o);if(s.rtc_center){const e=s.rtc_center;a.applyMatrix4((new t.Matrix4).makeTranslation(e[0],e[1],e[2]))}return a}(r,y);break;case Xs:case"mesh":i=yield function(r,s,i,n){return e(this,void 0,void 0,(function*(){return new Promise(((e,o)=>{const a=(new t.Matrix4).makeRotationAxis(new t.Vector3(1,0,0),Math.PI/2);r.parse(n.loadersGlGltf?s.content.gltf:s.content.gltfArrayBuffer,"",(r=>{const s=r.scenes[0].children[0];s.applyMatrix4(a),s.traverse((e=>{if(e instanceof t.Mesh){const t=e.material,r=t.map;n.material?(e.material=n.material.clone(),t.dispose()):n.shading==da.FlatTexture&&(e.material=i.clone(),t.dispose()),n.shading!=da.ShadedNoTexture?e.material.uniforms?e.material.uniforms.map={value:r}:e.material.map=r:(r.dispose(),e.material.map=null),n.shaderCallback&&(e.onBeforeRender=n.shaderCallback),e.material.wireframe=n.wireframe,n.computeNormals&&e.geometry.computeVertexNormals()}})),e(s)}),(t=>{o(new Error(`error parsing gltf in tile ${s.id}: ${t}`))}))}))}))}(T,r,v,s)}if(i&&(i.visible=!1,c[r.id]=i,l.add(c[r.id]),s.debug)){const e=function(e){const r=e.boundingVolume;let s=0;e.content&&(s=Math.min(e.content.byteLength/5e5,1));const i=new t.Color(s,1,0),n=new t.BoxGeometry(1,1,1),o=function(e){const r=e;return(new t.Matrix4).fromArray([2*r[0],2*r[1],2*r[2],0,2*r[3],2*r[4],2*r[5],0,2*r[6],2*r[7],2*r[8],0,0,0,0,1])}(r.halfAxes);n.applyMatrix4(o);const a=new t.EdgesGeometry(n),c=new t.LineSegments(a,new t.LineBasicMaterial({color:i}));return c.position.copy(new t.Vector3(...r.center)),c}(r);d.add(e),h[r.id]=e}})),onTileLoad:()=>e(this,void 0,void 0,(function*(){E&&(E._frameNumber++,L(E,c,w,b))})),onTileUnload:t=>{u.push(t)},onTileError:(t,e)=>{console.error("Tile error",t.id,e)}},E=new Ti(a,Object.assign(Object.assign({},_),{loadOptions:Object.assign(Object.assign({},o),{maxConcurrency:s.maxConcurrency,worker:s.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:s.loadersGlGltf}})}));let x=!1;const S=(new t.Vector3).setFromMatrixPosition(s.initialTransform);y.rootCenter.value.copy(S),y.rootNormal.value.copy(new t.Vector3(0,0,1).applyMatrix4(s.initialTransform).normalize()),l.applyMatrix4(s.initialTransform),E.stats.get("Loader concurrency").count=s.maxConcurrency,E.stats.get("Maximum SSE").count=s.maximumScreenSpaceError,E.stats.get("Maximum mem usage").count=s.maximumMemoryUsage;let M=0;const A=(new t.Matrix4).makeTranslation(1/0,1/0,1/0);let I=null;const R=new t.Vector3(1/0,1/0,1/0);let O=null;const C=(new t.Matrix4).copy(l.matrixWorld);function L(e,i,n,o){if(x)return;if(!O||o.aspect!=I){const t=new zs({fov:o.fov/180*Math.PI,aspectRatio:o.aspect,near:o.near,far:o.far});O=t.sseDenominator,I=o.aspect,s.debug&&console.log("Updated sse denonimator:",O)}const a=Io(o).planes.map((t=>new Cs(t.normal.toArray(),t.constant))),c=new ks(a),f=new t.Vector2;n.getSize(f);const p={camera:{position:R.toArray()},height:f.y,frameNumber:e._frameNumber,sseDenominator:O,cullingVolume:c,viewport:{id:0}};e._cache.reset(),e._traverser.traverse(e.root,p,e.options);for(const t of e.tiles)t.selected?i[t.id]?i[t.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",t.id):i[t.id]&&(i[t.id].visible=!1);for(;u.length>0;){const t=u.pop();i[t.id]&&0==t.contentState&&(l.remove(i[t.id]),ga(i[t.id]),delete i[t.id]),h[t.id]&&(ga(h[t.id]),d.remove(h[t.id]),delete h[t.id])}return r.onProgress&&r.onProgress(e.stats.get("Tiles Loaded").count,e.stats.get("Tiles Loaded").count+e.stats.get("Tiles Loading").count),p}return{model:l,runtime:{getTileset:()=>E,getStats:()=>E.stats,showTiles:t=>{d.visible=t},setWireframe:e=>{s.wireframe=e,l.traverse((r=>{r instanceof t.Mesh&&(r.material.wireframe=e)}))},setDebug:t=>{s.debug=t,d.visible=t},setShading:t=>{s.shading=t},getTileBoxes:()=>d,setViewDistanceScale:t=>{E.options.viewDistanceScale=t,E._frameNumber++,L(E,c,w,b)},setHideGround:t=>{y.hideGround.value=t},setPointCloudColoring:t=>{y.coloring.value=t},setElevationRange:t=>{y.elevationRange.value.set(t[0],t[1])},setMaxIntensity:t=>{y.maxIntensity.value=t},setIntensityContrast:t=>{y.intensityContrast.value=t},getLatLongHeightFromPosition:e=>{const r=E.ellipsoid.cartesianToCartographic((new t.Vector3).copy(e).applyMatrix4((new t.Matrix4).copy(f).invert()).toArray());return{lat:r[1],long:r[0],height:r[2]}},getPositionFromLatLongHeight:e=>{const r=E.ellipsoid.cartographicToCartesian([e.long,e.lat,e.height]);return new t.Vector3(...r).applyMatrix4(f)},getCameraFrustum:e=>{const r=Io(e).planes.map((t=>new Cs(t.normal.toArray(),t.constant))).map((e=>function(e){const r=new t.Group,s=new t.PlaneGeometry(10,5),i=new t.Vector3(...e.projectPointOntoPlane([0,0,0])),n=new t.Vector3(e.normal.x,e.normal.y,e.normal.z),o=(new t.Vector3).copy(i).add(n);s.lookAt(o),s.translate(i.x,i.y,i.z);const a=new t.MeshBasicMaterial({color:65535,side:t.DoubleSide}),c=new t.Mesh(s,a),h=new t.ArrowHelper(n,i,5,16776960);return r.add(h),r.add(c),r}(e))),s=new t.Group;for(const t of r)s.add(t);return s},update:function(t,e,r){b=r,w=e,M+=t,E&&M>=n&&(C.equals(l.matrixWorld)||(C.copy(l.matrixWorld),f=m.clone(),f.premultiply(C),g=new ur(f.toArray()),E.modelMatrix=g),(!r.matrixWorld.equals(A)||r.aspect!=I)&&(M=0,E._frameNumber++,r.getWorldPosition(R),A.copy(r.matrixWorld),L(E,c,e,r)))},dispose:function(){for(x=!0,E._destroy();l.children.length>0;){const t=l.children[0];ga(t),l.remove(t)}for(;d.children.length>0;){const t=d.children[0];d.remove(t),t.geometry.dispose(),t.material.dispose()}}}}}))}}.load({url:this.data.url,renderer:this.el.sceneEl.renderer,options:{dracoDecoderPath:"https://unpkg.com/three@0.133.0/examples/js/libs/draco",basisTranscoderPath:"https://unpkg.com/three@0.133.0/examples/js/libs/basis",cesiumIONToken:this.data.cesiumIONToken,maximumScreenSpaceError:this.data.maximumSSE,maximumMemoryUsage:this.data.maximumMem,viewDistanceScale:this.data.distanceScale,updateTransforms:!0}})},_initStats:function(){const t=document.createElement("a-entity");return this.el.sceneEl.appendChild(t),t.setAttribute("position","-0.5 0 -1"),t.setAttribute("textarea",{cols:30,rows:15,text:"",color:"white",disabledBackgroundColor:"#0c1e2c",disabled:!0}),t}})})(),i})()}));